if(!swfobject){var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac};}(),k=function(){if(!M.w3){return;}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f();}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false);}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f();}});if(O==top){(function(){if(J){return;}try{j.documentElement.doScroll("left");}catch(X){setTimeout(arguments.callee,0);return;}f();})();}}if(M.wk){(function(){if(J){return;}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return;}f();})();}s(f);}}();function f(){if(J){return;}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z);}catch(aa){return;}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]();}}function K(X){if(J){X();}else{U[U.length]=X;}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false);}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false);}else{if(typeof O.attachEvent!=D){i(O,"onload",Y);}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y();};}else{O.onload=Y;}}}}}function h(){if(T){V();}else{H();}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return;}}X.removeChild(aa);Z=null;H();})();}else{H();}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa);}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class");}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align");}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value");}}P(ai,ah,Y,ab);}else{p(ae);if(ab){ab(aa);}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z;}ab(aa);}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y;}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z;}}}return X;}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312);}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null;}else{l=ae;Q=X;}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310";}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137";}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac;}else{ab.flashvars=ac;}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae);}else{setTimeout(arguments.callee,10);}})();}u(aa,ab,X);}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y);}else{setTimeout(arguments.callee,10);}})();}else{Y.parentNode.replaceChild(g(Y),Y);}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML;}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true));}}}}}return aa;}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X;}if(aa){if(typeof ai.id==D){ai.id=Y;}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae];}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"';}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"';}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />';}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id);}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac]);}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac]);}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab]);}}aa.parentNode.replaceChild(Z,aa);X=Z;}}return X;}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa);}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y);}else{setTimeout(arguments.callee,10);}})();}else{X.parentNode.removeChild(X);}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null;}}Y.parentNode.removeChild(Y);}}function c(Z){var X=null;try{X=j.getElementById(Z);}catch(Y){}return X;}function C(X){return j.createElement(X);}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y];}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false;}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return;}var aa=j.getElementsByTagName("head")[0];if(!aa){return;}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null;}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1];}G=X;}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y);}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"));}}}function w(Z,X){if(!m){return;}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y;}else{v("#"+Z,"visibility:"+Y);}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y;}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2]);}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa]);}for(var Y in M){M[Y]=null;}M=null;for(var X in swfobject){swfobject[X]=null;}swfobject=null;});}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false);}else{if(Z){Z({success:false,id:ab});}}},getObjectById:function(X){if(M.w3){return z(X);}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al];}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak];}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai];}else{am.flashvars=ai+"="+Z[ai];}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true);}X.success=true;X.ref=an;}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return;}else{w(ah,true);}}if(ac){ac(X);}});}else{if(ac){ac(X);}}},switchOffAutoHideShow:function(){m=false;},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]};},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X);}else{return undefined;}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y);}},removeSWF:function(X){if(M.w3){y(X);}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X);}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1];}if(aa==null){return L(Z);}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)));}}}return"";},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block";}}if(E){E(B);}}a=false;}}};}();}if(jQuery){if(!jQuery.Jcrop){(function(a){a.Jcrop=function(d,A){var d=d,A=A;if(typeof(d)!=="object"){d=a(d)[0];}if(typeof(A)!=="object"){A={};}if(!("trackDocument" in A)){A.trackDocument=a.browser.msie?false:true;if(a.browser.msie&&a.browser.version.split(".")[0]=="8"){A.trackDocument=true;}}if(!("keySupport" in A)){A.keySupport=a.browser.msie?false:true;}var U={trackDocument:false,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,borderOpacity:0.4,handleOpacity:0.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:true,allowMove:true,allowResize:true,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}};var H=U;z(A);var W=a(d);var al=W.clone().removeAttr("id").css({position:"absolute"});al.width(W.width());al.height(W.height());W.after(al).hide();T(al,H.boxWidth,H.boxHeight);var Q=al.width(),O=al.height(),Z=a("<div />").width(Q).height(O).addClass(C("holder")).css({position:"relative",backgroundColor:H.bgColor}).insertAfter(W).append(al);if(H.addClass){Z.addClass(H.addClass);}var I=a("<img />").attr("src",al.attr("src")).css("position","absolute").width(Q).height(O);var k=a("<div />").width(K(100)).height(K(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(I);var L=a("<div />").width(K(100)).height(K(100)).css("zIndex",320);var y=a("<div />").css({position:"absolute",zIndex:300}).insertBefore(al).append(k,L);var t=H.boundary;var b=ae().width(Q+(t*2)).height(O+(t*2)).css({position:"absolute",top:l(-t),left:l(-t),zIndex:290}).mousedown(ac);var x,ah,p,S;var M,e,n=true;var ad=D(al),r,an,am,B,ab;var aa=function(){var aq=0,aC=0,ap=0,aB=0,au,ar;function aw(aF){var aF=at(aF);ap=aq=aF[0];aB=aC=aF[1];}function av(aF){var aF=at(aF);au=aF[0]-ap;ar=aF[1]-aB;ap=aF[0];aB=aF[1];}function aE(){return[au,ar];}function ao(aH){var aG=aH[0],aF=aH[1];if(0>aq+aG){aG-=aG+aq;}if(0>aC+aF){aF-=aF+aC;}if(O<aB+aF){aF+=O-(aB+aF);}if(Q<ap+aG){aG+=Q-(ap+aG);}aq+=aG;ap+=aG;aC+=aF;aB+=aF;}function ax(aF){var aG=aD();switch(aF){case"ne":return[aG.x2,aG.y];case"nw":return[aG.x,aG.y];case"se":return[aG.x2,aG.y2];case"sw":return[aG.x,aG.y2];}}function aD(){if(!H.aspectRatio){return aA();}var aH=H.aspectRatio,aO=H.minSize[0]/M,aN=H.minSize[1]/e,aG=H.maxSize[0]/M,aQ=H.maxSize[1]/e,aI=ap-aq,aP=aB-aC,aJ=Math.abs(aI),aK=Math.abs(aP),aL=aJ/aK,aF,aM;if(aG==0){aG=Q*10;}if(aQ==0){aQ=O*10;}if(aL<aH){aM=aB;w=aK*aH;aF=aI<0?aq-w:w+aq;if(aF<0){aF=0;h=Math.abs((aF-aq)/aH);aM=aP<0?aC-h:h+aC;}else{if(aF>Q){aF=Q;h=Math.abs((aF-aq)/aH);aM=aP<0?aC-h:h+aC;}}}else{aF=ap;h=aJ/aH;aM=aP<0?aC-h:aC+h;if(aM<0){aM=0;w=Math.abs((aM-aC)*aH);aF=aI<0?aq-w:w+aq;}else{if(aM>O){aM=O;w=Math.abs(aM-aC)*aH;aF=aI<0?aq-w:w+aq;}}}if(aF>aq){if(aF-aq<aO){aF=aq+aO;}else{if(aF-aq>aG){aF=aq+aG;}}if(aM>aC){aM=aC+(aF-aq)/aH;}else{aM=aC-(aF-aq)/aH;}}else{if(aF<aq){if(aq-aF<aO){aF=aq-aO;}else{if(aq-aF>aG){aF=aq-aG;}}if(aM>aC){aM=aC+(aq-aF)/aH;}else{aM=aC-(aq-aF)/aH;}}}if(aF<0){aq-=aF;aF=0;}else{if(aF>Q){aq-=aF-Q;aF=Q;}}if(aM<0){aC-=aM;aM=0;}else{if(aM>O){aC-=aM-O;aM=O;}}return last=az(ay(aq,aC,aF,aM));}function at(aF){if(aF[0]<0){aF[0]=0;}if(aF[1]<0){aF[1]=0;}if(aF[0]>Q){aF[0]=Q;}if(aF[1]>O){aF[1]=O;}return[aF[0],aF[1]];}function ay(aI,aK,aH,aJ){var aM=aI,aL=aH,aG=aK,aF=aJ;if(aH<aI){aM=aH;aL=aI;}if(aJ<aK){aG=aJ;aF=aK;}return[Math.round(aM),Math.round(aG),Math.round(aL),Math.round(aF)];}function aA(){var aG=ap-aq;var aF=aB-aC;if(x&&(Math.abs(aG)>x)){ap=(aG>0)?(aq+x):(aq-x);}if(ah&&(Math.abs(aF)>ah)){aB=(aF>0)?(aC+ah):(aC-ah);}if(S&&(Math.abs(aF)<S)){aB=(aF>0)?(aC+S):(aC-S);}if(p&&(Math.abs(aG)<p)){ap=(aG>0)?(aq+p):(aq-p);}if(aq<0){ap-=aq;aq-=aq;}if(aC<0){aB-=aC;aC-=aC;}if(ap<0){aq-=ap;ap-=ap;}if(aB<0){aC-=aB;aB-=aB;}if(ap>Q){var aH=ap-Q;aq-=aH;ap-=aH;}if(aB>O){var aH=aB-O;aC-=aH;aB-=aH;}if(aq>Q){var aH=aq-O;aB-=aH;aC-=aH;}if(aC>O){var aH=aC-O;aB-=aH;aC-=aH;}return az(ay(aq,aC,ap,aB));}function az(aF){return{x:aF[0],y:aF[1],x2:aF[2],y2:aF[3],w:aF[2]-aF[0],h:aF[3]-aF[1]};}return{flipCoords:ay,setPressed:aw,setCurrent:av,getOffset:aE,moveOffset:ao,getCorner:ax,getFixed:aD};}();var X=function(){var aw,ar,aC,aB,aK=370;var av={};var aO={};var aq=false;var aA=H.handleOffset;if(H.drawBorders){av={top:ax("hline").css("top",a.browser.msie?l(-1):l(0)),bottom:ax("hline"),left:ax("vline"),right:ax("vline")};}if(H.dragEdges){aO.t=aJ("n");aO.b=aJ("s");aO.r=aJ("e");aO.l=aJ("w");}H.sideHandles&&aF(["n","s","e","w"]);H.cornerHandles&&aF(["sw","nw","ne","se"]);function ax(aR){var aS=a("<div />").css({position:"absolute",opacity:H.borderOpacity}).addClass(C(aR));k.append(aS);return aS;}function ap(aR,aS){var aT=a("<div />").mousedown(c(aR)).css({cursor:aR+"-resize",position:"absolute",zIndex:aS});L.append(aT);return aT;}function aD(aR){return ap(aR,aK++).css({top:l(-aA+1),left:l(-aA+1),opacity:H.handleOpacity}).addClass(C("handle"));}function aJ(aT){var aW=H.handleSize,aX=aA,aV=aW,aS=aW,aU=aX,aR=aX;switch(aT){case"n":case"s":aS=K(100);break;case"e":case"w":aV=K(100);break;}return ap(aT,aK++).width(aS).height(aV).css({top:l(-aU+1),left:l(-aR+1)});}function aF(aR){for(i in aR){aO[aR[i]]=aD(aR[i]);}}function aH(aY){var aT=Math.round((aY.h/2)-aA),aS=Math.round((aY.w/2)-aA),aW=west=-aA+1,aV=aY.w-aA,aU=aY.h-aA,aR,aX;"e" in aO&&aO.e.css({top:l(aT),left:l(aV)})&&aO.w.css({top:l(aT)})&&aO.s.css({top:l(aU),left:l(aS)})&&aO.n.css({left:l(aS)});"ne" in aO&&aO.ne.css({left:l(aV)})&&aO.se.css({top:l(aU),left:l(aV)})&&aO.sw.css({top:l(aU)});"b" in aO&&aO.b.css({top:l(aU)})&&aO.r.css({left:l(aV)});}function az(aR,aS){I.css({top:l(-aS),left:l(-aR)});y.css({top:l(aS),left:l(aR)});}function aQ(aR,aS){y.width(aR).height(aS);}function at(){var aR=aa.getFixed();aa.setPressed([aR.x,aR.y]);aa.setCurrent([aR.x2,aR.y2]);aN();}function aN(){if(aB){return ay();}}function ay(){var aR=aa.getFixed();aQ(aR.w,aR.h);az(aR.x,aR.y);H.drawBorders&&av.right.css({left:l(aR.w-1)})&&av.bottom.css({top:l(aR.h-1)});aq&&aH(aR);aB||aP();H.onChange(Y(aR));}function aP(){y.show();al.css("opacity",H.bgOpacity);aB=true;}function aL(){aM();y.hide();al.css("opacity",1);aB=false;}function ao(){if(aq){aH(aa.getFixed());L.show();}}function aG(){aq=true;if(H.allowResize){aH(aa.getFixed());L.show();return true;}}function aM(){aq=false;L.hide();}function aI(aR){(B=aR)?aM():aG();}function aE(){aI(false);at();}var au=ae().mousedown(c("move")).css({cursor:"move",position:"absolute",zIndex:360});k.append(au);aM();return{updateVisible:aN,update:ay,release:aL,refresh:at,setCursor:function(aR){au.css("cursor",aR);},enableHandles:aG,enableOnly:function(){aq=true;},showHandles:ao,disableHandles:aM,animMode:aI,done:aE};}();var P=function(){var ap=function(){},ar=function(){},aq=H.trackDocument;if(!aq){b.mousemove(ao).mouseup(at).mouseout(at);}function ax(){b.css({zIndex:450});if(aq){a(document).mousemove(ao).mouseup(at);}}function aw(){b.css({zIndex:290});if(aq){a(document).unbind("mousemove",ao).unbind("mouseup",at);}}function ao(ay){ap(F(ay));}function at(ay){ay.preventDefault();ay.stopPropagation();if(r){r=false;ar(F(ay));H.onSelect(Y(aa.getFixed()));aw();ap=function(){};ar=function(){};}return false;}function au(az,ay){r=true;ap=az;ar=ay;ax();return false;}function av(ay){b.css("cursor",ay);}al.before(b);return{activateHandlers:au,setCursor:av};}();var ak=function(){var ar=a('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(ao).blur(at),au=a("<div />").css({position:"absolute",overflow:"hidden"}).append(ar);function ap(){if(H.keySupport){ar.show();ar.focus();}}function at(av){ar.hide();}function aq(aw,av,ax){if(H.allowMove){aa.moveOffset([av,ax]);X.updateVisible();}aw.preventDefault();aw.stopPropagation();}function ao(aw){if(aw.ctrlKey){return true;}ab=aw.shiftKey?true:false;var av=ab?10:1;switch(aw.keyCode){case 37:aq(aw,-av,0);break;case 39:aq(aw,av,0);break;case 38:aq(aw,0,-av);break;case 40:aq(aw,0,av);break;case 27:X.release();break;case 9:return true;}return nothing(aw);}if(H.keySupport){au.insertBefore(al);}return{watchKeys:ap};}();function l(ao){return""+parseInt(ao)+"px";}function K(ao){return""+parseInt(ao)+"%";}function C(ao){return H.baseClass+"-"+ao;}function D(ao){var ap=a(ao).offset();return[ap.left,ap.top];}function F(ao){return[(ao.pageX-ad[0]),(ao.pageY-ad[1])];}function E(ao){if(ao!=an){P.setCursor(ao);an=ao;}}function f(aq,at){ad=D(al);P.setCursor(aq=="move"?aq:aq+"-resize");if(aq=="move"){return P.activateHandlers(R(at),o);}var ao=aa.getFixed();var ap=q(aq);var ar=aa.getCorner(q(ap));aa.setPressed(aa.getCorner(ap));aa.setCurrent(ar);P.activateHandlers(G(aq,ao),o);}function G(ap,ao){return function(aq){if(!H.aspectRatio){switch(ap){case"e":aq[1]=ao.y2;break;case"w":aq[1]=ao.y2;break;case"n":aq[0]=ao.x2;break;case"s":aq[0]=ao.x2;break;}}else{switch(ap){case"e":aq[1]=ao.y+1;break;case"w":aq[1]=ao.y+1;break;case"n":aq[0]=ao.x+1;break;case"s":aq[0]=ao.x+1;break;}}aa.setCurrent(aq);X.update();};}function R(ap){var ao=ap;ak.watchKeys();return function(aq){aa.moveOffset([aq[0]-ao[0],aq[1]-ao[1]]);ao=aq;X.update();};}function q(ao){switch(ao){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne";}}function c(ao){return function(ap){if(H.disabled){return false;}if((ao=="move")&&!H.allowMove){return false;}r=true;f(ao,F(ap));ap.stopPropagation();ap.preventDefault();return false;};}function T(at,ap,ar){var ao=at.width(),aq=at.height();if((ao>ap)&&ap>0){ao=ap;aq=(ap/at.width())*at.height();}if((aq>ar)&&ar>0){aq=ar;ao=(ar/at.height())*at.width();}M=at.width()/ao;e=at.height()/aq;at.width(ao).height(aq);}function Y(ao){return{x:parseInt(ao.x*M),y:parseInt(ao.y*e),x2:parseInt(ao.x2*M),y2:parseInt(ao.y2*e),w:parseInt(ao.w*M),h:parseInt(ao.h*e)};}function o(ap){var ao=aa.getFixed();if(ao.w>H.minSelect[0]&&ao.h>H.minSelect[1]){X.enableHandles();X.done();}else{X.release();}P.setCursor(H.allowSelect?"crosshair":"default");}function ac(ao){if(H.disabled){return false;}if(!H.allowSelect){return false;}r=true;ad=D(al);X.disableHandles();E("crosshair");var ap=F(ao);aa.setPressed(ap);P.activateHandlers(aj,o);ak.watchKeys();X.update();ao.stopPropagation();ao.preventDefault();return false;}function aj(ao){aa.setCurrent(ao);X.update();}function ae(){var ao=a("<div></div>").addClass(C("tracker"));a.browser.msie&&ao.css({opacity:0,backgroundColor:"white"});return ao;}function s(aG){var aB=aG[0]/M,ap=aG[1]/e,aA=aG[2]/M,ao=aG[3]/e;if(B){return;}var az=aa.flipCoords(aB,ap,aA,ao);var aE=aa.getFixed();var ar=initcr=[aE.x,aE.y,aE.x2,aE.y2];var aq=H.animationDelay;var ax=ar[0];var aw=ar[1];var aA=ar[2];var ao=ar[3];var aD=az[0]-initcr[0];var au=az[1]-initcr[1];var aC=az[2]-initcr[2];var at=az[3]-initcr[3];var ay=0;var av=H.swingSpeed;X.animMode(true);var aF=function(){return function(){ay+=(100-ay)/av;ar[0]=ax+((ay/100)*aD);ar[1]=aw+((ay/100)*au);ar[2]=aA+((ay/100)*aC);ar[3]=ao+((ay/100)*at);if(ay<100){aH();}else{X.done();}if(ay>=99.8){ay=100;}ai(ar);};}();function aH(){window.setTimeout(aF,aq);}aH();}function J(ao){ai([ao[0]/M,ao[1]/e,ao[2]/M,ao[3]/e]);}function ai(ao){aa.setPressed([ao[0],ao[1]]);aa.setCurrent([ao[2],ao[3]]);X.update();}function z(ao){if(typeof(ao)!="object"){ao={};}H=a.extend(H,ao);if(typeof(H.onChange)!=="function"){H.onChange=function(){};}if(typeof(H.onSelect)!=="function"){H.onSelect=function(){};}}function j(){return Y(aa.getFixed());}function ag(){return aa.getFixed();}function u(ao){z(ao);N();}function v(){H.disabled=true;X.disableHandles();X.setCursor("default");P.setCursor("default");}function V(){H.disabled=false;N();}function m(){X.done();P.activateHandlers(null,null);}function af(){Z.remove();W.show();}function N(ao){H.allowResize?ao?X.enableOnly():X.enableHandles():X.disableHandles();P.setCursor(H.allowSelect?"crosshair":"default");X.setCursor(H.allowMove?"move":"default");Z.css("backgroundColor",H.bgColor);if("setSelect" in H){J(A.setSelect);X.done();delete (H.setSelect);}if("trueSize" in H){M=H.trueSize[0]/Q;e=H.trueSize[1]/O;}x=H.maxSize[0]||0;ah=H.maxSize[1]||0;p=H.minSize[0]||0;S=H.minSize[1]||0;if("outerImage" in H){al.attr("src",H.outerImage);delete (H.outerImage);}X.refresh();}L.hide();N(true);var g={animateTo:s,setSelect:J,setOptions:u,tellSelect:j,tellScaled:ag,disable:v,enable:V,cancel:m,focus:ak.watchKeys,getBounds:function(){return[Q*M,O*e];},getWidgetSize:function(){return[Q,O];},release:X.release,destroy:af};W.data("Jcrop",g);return g;};a.fn.Jcrop=function(c){function b(f){var e=c.useImg||f.src;var d=new Image();d.onload=function(){a.Jcrop(f,c);};d.src=e;}if(typeof(c)!=="object"){c={};}this.each(function(){if(a(this).data("Jcrop")){if(c=="api"){return a(this).data("Jcrop");}else{a(this).data("Jcrop").setOptions(c);}}else{b(this);}});return this;};})(jQuery);}if(!jQuery.fn.uploadify){if(jQuery){(function(a){a.extend(a.fn,{uploadify:function(b){a(this).each(function(){settings=a.extend({id:a(this).attr("id"),uploader:"uploadify.swf",script:"uploadify.php",expressInstall:null,folder:"",height:30,width:110,cancelImg:"cancel.png",wmode:"opaque",scriptAccess:"sameDomain",fileDataName:"Filedata",method:"POST",queueSizeLimit:999,simUploadLimit:1,queueID:false,displayData:"percentage",onInit:function(){},onSelect:function(){},onQueueFull:function(){},onCheck:function(){},onCancel:function(){},onError:function(){},onProgress:function(){},onComplete:function(){},onAllComplete:function(){}},b);var e=location.pathname;e=e.split("/");e.pop();e=e.join("/")+"/";var f={};f.uploadifyID=settings.id;f.pagepath=e;if(settings.buttonImg){f.buttonImg=escape(settings.buttonImg);}if(settings.buttonText){f.buttonText=escape(settings.buttonText);}if(settings.rollover){f.rollover=true;}f.script=settings.script;f.folder=escape(settings.folder);if(settings.scriptData){var g="";for(var d in settings.scriptData){g+="&"+d+"="+settings.scriptData[d];}f.scriptData=escape(g.substr(1));}f.width=settings.width;f.height=settings.height;f.wmode=settings.wmode;f.method=settings.method;f.queueSizeLimit=settings.queueSizeLimit;f.simUploadLimit=settings.simUploadLimit;if(settings.hideButton){f.hideButton=true;}if(settings.fileDesc){f.fileDesc=settings.fileDesc;}if(settings.fileExt){f.fileExt=settings.fileExt;}if(settings.multi){f.multi=true;}if(settings.auto){f.auto=true;}if(settings.sizeLimit){f.sizeLimit=settings.sizeLimit;}if(settings.checkScript){f.checkScript=settings.checkScript;}if(settings.fileDataName){f.fileDataName=settings.fileDataName;}if(settings.queueID){f.queueID=settings.queueID;}if(settings.onInit()!==false){a(this).css("display","none");a(this).after('<div id="'+a(this).attr("id")+'Uploader"></div>');swfobject.embedSWF(settings.uploader,settings.id+"Uploader",settings.width,settings.height,"9.0.24",settings.expressInstall,f,{quality:"high",wmode:settings.wmode,allowScriptAccess:settings.scriptAccess});if(settings.queueID==false){a("#"+a(this).attr("id")+"Uploader").after('<div id="'+a(this).attr("id")+'Queue" class="uploadifyQueue"></div>');}}if(typeof(settings.onOpen)=="function"){a(this).bind("uploadifyOpen",settings.onOpen);}a(this).bind("uploadifySelect",{action:settings.onSelect,queueID:settings.queueID},function(j,h,i){if(j.data.action(j,h,i)!==false){var k=Math.round(i.size/1024*100)*0.01;var l="KB";if(k>1000){k=Math.round(k*0.001*100)*0.01;l="MB";}var m=k.toString().split(".");if(m.length>1){k=m[0]+"."+m[1].substr(0,2);}else{k=m[0];}if(i.name.length>20){fileName=i.name.substr(0,20)+"...";}else{fileName=i.name;}queue="#"+a(this).attr("id")+"Queue";if(j.data.queueID){queue="#"+j.data.queueID;}a(queue).append('<div id="'+a(this).attr("id")+h+'" class="uploadifyQueueItem">								<div class="cancel">									<a href="javascript:jQuery(\'#'+a(this).attr("id")+"').uploadifyCancel('"+h+'\')"><img src="'+settings.cancelImg+'" border="0" /></a>					</div>								<span class="fileName">'+fileName+" ("+k+l+')</span><span class="percentage"></span>								<div class="uploadifyProgress"><div id="'+a(this).attr("id")+h+'ProgressBar" class="uploadifyProgressBar"><!--Progress Bar--></div>			</div>							</div>');}});if(typeof(settings.onSelectOnce)=="function"){a(this).bind("uploadifySelectOnce",settings.onSelectOnce);}a(this).bind("uploadifyQueueFull",{action:settings.onQueueFull},function(h,i){if(h.data.action(h,i)!==false){alert("The queue is full.  The max size is "+i+".");}});a(this).bind("uploadifyCheckExist",{action:settings.onCheck},function(m,l,k,j,o){var i=new Object();i=k;i.folder=e+j;if(o){for(var h in k){var n=h;}}a.post(l,i,function(r){for(var p in r){if(m.data.action(m,l,k,j,o)!==false){var q=confirm("Do you want to replace the file "+r[p]+"?");if(!q){document.getElementById(a(m.target).attr("id")+"Uploader").cancelFileUpload(p,true,true);}}}if(o){document.getElementById(a(m.target).attr("id")+"Uploader").startFileUpload(n,true);}else{document.getElementById(a(m.target).attr("id")+"Uploader").startFileUpload(null,true);}},"json");});a(this).bind("uploadifyCancel",{action:settings.onCancel},function(l,h,k,m,j){if(l.data.action(l,h,k,m,j)!==false){var i=(j==true)?0:250;a("#"+a(this).attr("id")+h).fadeOut(i,function(){a(this).remove();});}});if(typeof(settings.onClearQueue)=="function"){a(this).bind("uploadifyClearQueue",settings.onClearQueue);}var c=[];a(this).bind("uploadifyError",{action:settings.onError},function(l,h,k,j){if(l.data.action(l,h,k,j)!==false){var i=new Array(h,k,j);c.push(i);a("#"+a(this).attr("id")+h+" .percentage").text(" - "+j.type+" Error");a("#"+a(this).attr("id")+h).addClass("uploadifyError");}});a(this).bind("uploadifyProgress",{action:settings.onProgress,toDisplay:settings.displayData},function(j,h,i,k){if(j.data.action(j,h,i,k)!==false){a("#"+a(this).attr("id")+h+"ProgressBar").css("width",k.percentage+"%");if(j.data.toDisplay=="percentage"){displayData=" - "+k.percentage+"%";}if(j.data.toDisplay=="speed"){displayData=" - "+k.speed+"KB/s";}if(j.data.toDisplay==null){displayData=" ";}a("#"+a(this).attr("id")+h+" .percentage").text(displayData);}});a(this).bind("uploadifyComplete",{action:settings.onComplete},function(k,h,j,i,l){if(k.data.action(k,h,j,unescape(i),l)!==false){a("#"+a(this).attr("id")+h+" .percentage").text(" - Completed");a("#"+a(this).attr("id")+h).fadeOut(250,function(){a(this).remove();});}});if(typeof(settings.onAllComplete)=="function"){a(this).bind("uploadifyAllComplete",{action:settings.onAllComplete},function(h,i){if(h.data.action(h,i)!==false){c=[];}});}});},uploadifySettings:function(f,j,c){var g=false;a(this).each(function(){if(f=="scriptData"&&j!=null){if(c){var i=j;}else{var i=a.extend(settings.scriptData,j);}var l="";for(var k in i){l+="&"+k+"="+escape(i[k]);}j=l.substr(1);}g=document.getElementById(a(this).attr("id")+"Uploader").updateSettings(f,j);});if(j==null){if(f=="scriptData"){var b=unescape(g).split("&");var e=new Object();for(var d=0;d<b.length;d++){var h=b[d].split("=");e[h[0]]=h[1];}g=e;}return g;}},uploadifyUpload:function(b){a(this).each(function(){document.getElementById(a(this).attr("id")+"Uploader").startFileUpload(b,false);});},uploadifyCancel:function(b){a(this).each(function(){document.getElementById(a(this).attr("id")+"Uploader").cancelFileUpload(b,true,false);});},uploadifyClearQueue:function(){a(this).each(function(){document.getElementById(a(this).attr("id")+"Uploader").clearFileUploadQueue(false);});}});})(jQuery);}}if(!jQuery.fn.validate){(function(a){a.extend(a.fn,{validate:function(b){if(!this.length){b&&b.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return;}var c=a.data(this[0],"validator");if(c){return c;}c=new a.validator(b,this[0]);a.data(this[0],"validator",c);if(c.settings.onsubmit){this.find("input, button").filter(".cancel").click(function(){c.cancelSubmit=true;});if(c.settings.submitHandler){this.find("input, button").filter(":submit").click(function(){c.submitButton=this;});}this.submit(function(d){if(c.settings.debug){d.preventDefault();}function e(){if(c.settings.submitHandler){if(c.submitButton){var f=a("<input type='hidden'/>").attr("name",c.submitButton.name).val(c.submitButton.value).appendTo(c.currentForm);}c.settings.submitHandler.call(c,c.currentForm);if(c.submitButton){f.remove();}return false;}return true;}if(c.cancelSubmit){c.cancelSubmit=false;return e();}if(c.form()){if(c.pendingRequest){c.formSubmitted=true;return false;}return e();}else{c.focusInvalid();return false;}});}return c;},valid:function(){if(a(this[0]).is("form")){return this.validate().form();}else{var c=true;var b=a(this[0].form).validate();this.each(function(){c&=b.element(this);});return c;}},removeAttrs:function(d){var b={},c=this;a.each(d.split(/\s/),function(e,f){b[f]=c.attr(f);c.removeAttr(f);});return b;},rules:function(e,b){var g=this[0];if(e){var d=a.data(g.form,"validator").settings;var i=d.rules;var j=a.validator.staticRules(g);switch(e){case"add":a.extend(j,a.validator.normalizeRule(b));i[g.name]=j;if(b.messages){d.messages[g.name]=a.extend(d.messages[g.name],b.messages);}break;case"remove":if(!b){delete i[g.name];return j;}var h={};a.each(b.split(/\s/),function(k,l){h[l]=j[l];delete j[l];});return h;}}var f=a.validator.normalizeRules(a.extend({},a.validator.metadataRules(g),a.validator.classRules(g),a.validator.attributeRules(g),a.validator.staticRules(g)),g);if(f.required){var c=f.required;delete f.required;f=a.extend({required:c},f);}return f;}});a.extend(a.expr[":"],{blank:function(b){return !a.trim(""+b.value);},filled:function(b){return !!a.trim(""+b.value);},unchecked:function(b){return !b.checked;}});a.validator=function(b,c){this.settings=a.extend(true,{},a.validator.defaults,b);this.currentForm=c;this.init();};a.validator.format=function(b,c){if(arguments.length==1){return function(){var d=a.makeArray(arguments);d.unshift(b);return a.validator.format.apply(this,d);};}if(arguments.length>2&&c.constructor!=Array){c=a.makeArray(arguments).slice(1);}if(c.constructor!=Array){c=[c];}a.each(c,function(d,e){b=b.replace(new RegExp("\\{"+d+"\\}","g"),e);});return b;};a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:true,ignore:[],ignoreTitle:false,onfocusin:function(b){this.lastActive=b;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,b,this.settings.errorClass,this.settings.validClass);this.errorsFor(b).hide();}},onfocusout:function(b){if(!this.checkable(b)&&(b.name in this.submitted||!this.optional(b))){this.element(b);}},onkeyup:function(b){if(b.name in this.submitted||b==this.lastElement){this.element(b);}},onclick:function(b){if(b.name in this.submitted){this.element(b);}else{if(b.parentNode.name in this.submitted){this.element(b.parentNode);}}},highlight:function(d,b,c){a(d).addClass(b).removeClass(c);},unhighlight:function(d,b,c){a(d).removeClass(b).addClass(c);}},setDefaults:function(b){a.extend(a.validator.defaults,b);},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=a(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm);this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var b=(this.groups={});a.each(this.settings.groups,function(e,f){a.each(f.split(/\s/),function(h,g){b[g]=e;});});var d=this.settings.rules;a.each(d,function(e,f){d[e]=a.validator.normalizeRule(f);});function c(g){var f=a.data(this[0].form,"validator"),e="on"+g.type.replace(/^validate/,"");f.settings[e]&&f.settings[e].call(f,this[0]);}a(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",c).validateDelegate(":radio, :checkbox, select, option","click",c);if(this.settings.invalidHandler){a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler);}},form:function(){this.checkForm();a.extend(this.submitted,this.errorMap);this.invalid=a.extend({},this.errorMap);if(!this.valid()){a(this.currentForm).triggerHandler("invalid-form",[this]);}this.showErrors();return this.valid();},checkForm:function(){this.prepareForm();for(var b=0,c=(this.currentElements=this.elements());c[b];b++){this.check(c[b]);}return this.valid();},element:function(c){c=this.clean(c);this.lastElement=c;this.prepareElement(c);this.currentElements=a(c);var b=this.check(c);if(b){delete this.invalid[c.name];}else{this.invalid[c.name]=true;}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers);}this.showErrors();return b;},showErrors:function(c){if(c){a.extend(this.errorMap,c);this.errorList=[];for(var b in c){this.errorList.push({message:c[b],element:this.findByName(b)[0]});}this.successList=a.grep(this.successList,function(d){return !(d.name in c);});}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors();},resetForm:function(){if(a.fn.resetForm){a(this.currentForm).resetForm();}this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass);},numberOfInvalids:function(){return this.objectLength(this.invalid);},objectLength:function(d){var c=0;for(var b in d){c++;}return c;},hideErrors:function(){this.addWrapper(this.toHide).hide();},valid:function(){return this.size()==0;},size:function(){return this.errorList.length;},focusInvalid:function(){if(this.settings.focusInvalid){try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin");}catch(b){}}},findLastActive:function(){var b=this.lastActive;return b&&a.grep(this.errorList,function(c){return c.element.name==b.name;}).length==1&&b;},elements:function(){var c=this,b={};return a([]).add(this.currentForm.elements).filter(":input").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&c.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!c.objectLength(a(this).rules())){return false;}b[this.name]=true;return true;});},clean:function(b){return a(b)[0];},errors:function(){return a(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext);},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=a([]);this.toHide=a([]);this.currentElements=a([]);},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers);},prepareElement:function(b){this.reset();this.toHide=this.errorsFor(b);},check:function(c){c=this.clean(c);if(this.checkable(c)){c=this.findByName(c.name)[0];}var h=a(c).rules();var d=false;for(method in h){var g={method:method,parameters:h[method]};try{var b=a.validator.methods[method].call(this,c.value.replace(/\r/g,""),c,g.parameters);if(b=="dependency-mismatch"){d=true;continue;}d=false;if(b=="pending"){this.toHide=this.toHide.not(this.errorsFor(c));return;}if(!b){this.formatAndAdd(c,g);return false;}}catch(f){this.settings.debug&&window.console&&console.log("exception occured when checking element "+c.id+", check the '"+g.method+"' method",f);throw f;}}if(d){return;}if(this.objectLength(h)){this.successList.push(c);}return true;},customMetaMessage:function(b,d){if(!a.metadata){return;}var c=this.settings.meta?a(b).metadata()[this.settings.meta]:a(b).metadata();return c&&c.messages&&c.messages[d];},customMessage:function(c,d){var b=this.settings.messages[c];return b&&(b.constructor==String?b:b[d]);},findDefined:function(){for(var b=0;b<arguments.length;b++){if(arguments[b]!==undefined){return arguments[b];}}return undefined;},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customMetaMessage(b,c),!this.settings.ignoreTitle&&b.title||undefined,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>");},formatAndAdd:function(c,e){var d=this.defaultMessage(c,e.method),b=/\$?\{(\d+)\}/g;if(typeof d=="function"){d=d.call(this,e.parameters,c);}else{if(b.test(d)){d=jQuery.format(d.replace(b,"{$1}"),e.parameters);}}this.errorList.push({message:d,element:c});this.errorMap[c.name]=d;this.submitted[c.name]=d;},addWrapper:function(b){if(this.settings.wrapper){b=b.add(b.parent(this.settings.wrapper));}return b;},defaultShowErrors:function(){for(var c=0;this.errorList[c];c++){var b=this.errorList[c];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass);this.showLabel(b.element,b.message);}if(this.errorList.length){this.toShow=this.toShow.add(this.containers);}if(this.settings.success){for(var c=0;this.successList[c];c++){this.showLabel(this.successList[c]);}}if(this.settings.unhighlight){for(var c=0,d=this.validElements();d[c];c++){this.settings.unhighlight.call(this,d[c],this.settings.errorClass,this.settings.validClass);}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show();},validElements:function(){return this.currentElements.not(this.invalidElements());},invalidElements:function(){return a(this.errorList).map(function(){return this.element;});},showLabel:function(c,d){var b=this.errorsFor(c);if(b.length){b.removeClass().addClass(this.settings.errorClass);b.attr("generated")&&b.html(d);}else{b=a("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(c),generated:true}).addClass(this.settings.errorClass).html(d||"");if(this.settings.wrapper){b=b.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();}if(!this.labelContainer.append(b).length){this.settings.errorPlacement?this.settings.errorPlacement(b,a(c)):b.insertAfter(c);}}if(!d&&this.settings.success){b.text("");typeof this.settings.success=="string"?b.addClass(this.settings.success):this.settings.success(b);}this.toShow=this.toShow.add(b);},errorsFor:function(c){var b=this.idOrName(c);return this.errors().filter(function(){return a(this).attr("for")==b;});},idOrName:function(b){return this.groups[b.name]||(this.checkable(b)?b.name:b.id||b.name);},checkable:function(b){return/radio|checkbox/i.test(b.type);},findByName:function(b){var c=this.currentForm;return a(document.getElementsByName(b)).map(function(d,e){return e.form==c&&e.name==b&&e||null;});},getLength:function(c,b){switch(b.nodeName.toLowerCase()){case"select":return a("option:selected",b).length;case"input":if(this.checkable(b)){return this.findByName(b.name).filter(":checked").length;}}return c.length;},depend:function(c,b){return this.dependTypes[typeof c]?this.dependTypes[typeof c](c,b):true;},dependTypes:{"boolean":function(c,b){return c;},string:function(c,b){return !!a(c,b.form).length;},"function":function(c,b){return c(b);}},optional:function(b){return !a.validator.methods.required.call(this,a.trim(b.value),b)&&"dependency-mismatch";},startRequest:function(b){if(!this.pending[b.name]){this.pendingRequest++;this.pending[b.name]=true;}},stopRequest:function(b,c){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0;}delete this.pending[b.name];if(c&&this.pendingRequest==0&&this.formSubmitted&&this.form()){a(this.currentForm).submit();this.formSubmitted=false;}else{if(!c&&this.pendingRequest==0&&this.formSubmitted){a(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false;}}},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:true,message:this.defaultMessage(b,"remote")});}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(b,c){b.constructor==String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b);},classRules:function(c){var d={};var b=a(c).attr("class");b&&a.each(b.split(" "),function(){if(this in a.validator.classRuleSettings){a.extend(d,a.validator.classRuleSettings[this]);}});return d;},attributeRules:function(c){var e={};var b=a(c);for(method in a.validator.methods){var d=b.attr(method);if(d){e[method]=d;}}if(e.maxlength&&/-1|2147483647|524288/.test(e.maxlength)){delete e.maxlength;}return e;},metadataRules:function(b){if(!a.metadata){return{};}var c=a.data(b.form,"validator").settings.meta;return c?a(b).metadata()[c]:a(b).metadata();},staticRules:function(c){var d={};var b=a.data(c.form,"validator");if(b.settings.rules){d=a.validator.normalizeRule(b.settings.rules[c.name])||{};}return d;},normalizeRules:function(c,b){a.each(c,function(f,e){if(e===false){delete c[f];return;}if(e.param||e.depends){var d=true;switch(typeof e.depends){case"string":d=!!a(e.depends,b.form).length;break;case"function":d=e.depends.call(b,b);break;}if(d){c[f]=e.param!==undefined?e.param:true;}else{delete c[f];}}});a.each(c,function(d,e){c[d]=a.isFunction(e)?e(b):e;});a.each(["minlength","maxlength","min","max"],function(){if(c[this]){c[this]=Number(c[this]);}});a.each(["rangelength","range"],function(){if(c[this]){c[this]=[Number(c[this][0]),Number(c[this][1])];}});if(a.validator.autoCreateRanges){if(c.min&&c.max){c.range=[c.min,c.max];delete c.min;delete c.max;}if(c.minlength&&c.maxlength){c.rangelength=[c.minlength,c.maxlength];delete c.minlength;delete c.maxlength;}}if(c.messages){delete c.messages;}return c;},normalizeRule:function(c){if(typeof c=="string"){var b={};a.each(c.split(/\s/),function(){b[this]=true;});c=b;}return c;},addMethod:function(b,d,c){a.validator.methods[b]=d;a.validator.messages[b]=c!=undefined?c:a.validator.messages[b];if(d.length<3){a.validator.addClassRules(b,a.validator.normalizeRule(b));}},methods:{required:function(c,b,e){if(!this.depend(e,b)){return"dependency-mismatch";}switch(b.nodeName.toLowerCase()){case"select":var d=a(b).val();return d&&d.length>0;case"input":if(this.checkable(b)){return this.getLength(c,b)>0;}default:return a.trim(c).length>0;}},remote:function(f,c,g){if(this.optional(c)){return"dependency-mismatch";}var d=this.previousValue(c);if(!this.settings.messages[c.name]){this.settings.messages[c.name]={};}d.originalMessage=this.settings.messages[c.name].remote;this.settings.messages[c.name].remote=d.message;g=typeof g=="string"&&{url:g}||g;if(d.old!==f){d.old=f;var b=this;this.startRequest(c);var e={};e[c.name]=f;a.ajax(a.extend(true,{url:g,mode:"abort",port:"validate"+c.name,dataType:"json",data:e,success:function(i){b.settings.messages[c.name].remote=d.originalMessage;var k=i===true;if(k){var h=b.formSubmitted;b.prepareElement(c);b.formSubmitted=h;b.successList.push(c);b.showErrors();}else{var l={};var j=(d.message=i||b.defaultMessage(c,"remote"));l[c.name]=a.isFunction(j)?j(f):j;b.showErrors(l);}d.valid=k;b.stopRequest(c,k);}},g));return"pending";}else{if(this.pending[c.name]){return"pending";}}return d.valid;},minlength:function(c,b,d){return this.optional(b)||this.getLength(a.trim(c),b)>=d;},maxlength:function(c,b,d){return this.optional(b)||this.getLength(a.trim(c),b)<=d;},rangelength:function(d,b,e){var c=this.getLength(a.trim(d),b);return this.optional(b)||(c>=e[0]&&c<=e[1]);},min:function(c,b,d){return this.optional(b)||c>=d;},max:function(c,b,d){return this.optional(b)||c<=d;},range:function(c,b,d){return this.optional(b)||(c>=d[0]&&c<=d[1]);},email:function(c,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(c);},url:function(c,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(c);},date:function(c,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(c));},dateISO:function(c,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(c);},number:function(c,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(c);},digits:function(c,b){return this.optional(b)||/^\d+$/.test(c);},creditcard:function(f,c){if(this.optional(c)){return"dependency-mismatch";}if(/[^0-9-]+/.test(f)){return false;}var g=0,e=0,b=false;f=f.replace(/\D/g,"");for(var h=f.length-1;h>=0;h--){var d=f.charAt(h);var e=parseInt(d,10);if(b){if((e*=2)>9){e-=9;}}g+=e;b=!b;}return(g%10)==0;},accept:function(c,b,d){d=typeof d=="string"?d.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||c.match(new RegExp(".("+d+")$","i"));},equalTo:function(c,b,e){var d=a(e).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(b).valid();});return c==d.val();}}});a.format=a.validator.format;})(jQuery);(function(c){var b=c.ajax;var a={};c.ajax=function(e){e=c.extend(e,c.extend({},c.ajaxSettings,e));var d=e.port;if(e.mode=="abort"){if(a[d]){a[d].abort();}return(a[d]=b.apply(this,arguments));}return b.apply(this,arguments);};})(jQuery);(function(a){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){a.each({focus:"focusin",blur:"focusout"},function(c,b){a.event.special[b]={setup:function(){this.addEventListener(c,d,true);},teardown:function(){this.removeEventListener(c,d,true);},handler:function(f){arguments[0]=a.event.fix(f);arguments[0].type=b;return a.event.handle.apply(this,arguments);}};function d(f){f=a.event.fix(f);f.type=b;return a.event.handle.call(this,f);}});}a.extend(a.fn,{validateDelegate:function(d,c,b){return this.bind(c,function(e){var f=a(e.target);if(f.is(d)){return b.apply(f,arguments);}});}});})(jQuery);}}(function($){var colorbox="colorbox",hover="hover",TRUE=true,FALSE=false,cboxPublic,isIE=!$.support.opacity,isIE6=isIE&&!window.XMLHttpRequest,cbox_open="sso_cbox_open",cbox_load="sso_cbox_load",cbox_complete="sso_cbox_complete",cbox_cleanup="sso_cbox_cleanup",cbox_closed="sso_cbox_closed",cbox_resize="resize.sso_cbox_resize",$overlay,$cbox,$wrap,$content,$topBorder,$leftBorder,$rightBorder,$bottomBorder,$related,$window,$loaded,$loadingBay,$loadingOverlay,$loadingGraphic,$title,$current,$slideshow,$next,$prev,$close,interfaceHeight,interfaceWidth,loadedHeight,loadedWidth,element,bookmark,index,settings,open,active,defaults={transition:"elastic",speed:350,width:FALSE,height:FALSE,innerWidth:FALSE,innerHeight:FALSE,initialWidth:"400",initialHeight:"400",maxWidth:FALSE,maxHeight:FALSE,scalePhotos:TRUE,scrolling:TRUE,inline:FALSE,html:FALSE,iframe:FALSE,photo:FALSE,href:FALSE,title:FALSE,rel:FALSE,opacity:0.9,preloading:TRUE,current:"image {current} of {total}",previous:"previous",next:"next",close:"close",open:FALSE,overlayClose:TRUE,slideshow:FALSE,slideshowAuto:TRUE,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",onOpen:FALSE,onLoad:FALSE,onComplete:FALSE,onCleanup:FALSE,onClosed:FALSE};function setSize(size,dimension){dimension=dimension==="x"?$window.width():$window.height();return(typeof size==="string")?Math.round((size.match(/%/)?(dimension/100)*parseInt(size,10):parseInt(size,10))):size;}function isImage(url){url=$.isFunction(url)?url.call(element):url;return settings.photo||url.match(/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i);}function process(){for(var i in settings){if($.isFunction(settings[i])&&i.substring(0,2)!=="on"){settings[i]=settings[i].call(element);}}settings.rel=settings.rel||element.rel;settings.href=settings.href||element.href;settings.title=settings.title||element.title;}function launch(elem){element=elem;settings=$(element).data(colorbox);process();if(settings.rel&&settings.rel!=="nofollow"){$related=$(".cboxElement").filter(function(){var relRelated=$(this).data(colorbox).rel||this.rel;return(relRelated===settings.rel);});index=$related.index(element);if(index<0){$related=$related.add(element);index=$related.length-1;}}else{$related=$(element);index=0;}if(!open){open=TRUE;active=TRUE;bookmark=element;bookmark.blur();$(document).bind("keydown.cbox_close",function(e){if(e.keyCode===27){e.preventDefault();cboxPublic.close();}}).bind("keydown.cbox_arrows",function(e){if($related.length>1){if(e.keyCode===37){e.preventDefault();$prev.click();}else{if(e.keyCode===39){e.preventDefault();$next.click();}}}});if(settings.overlayClose){$overlay.css({cursor:"pointer"}).one("click",cboxPublic.close);}$.event.trigger(cbox_open);if(settings.onOpen){settings.onOpen.call(element);}$overlay.css({opacity:settings.opacity}).show();settings.w=setSize(settings.initialWidth,"x");settings.h=setSize(settings.initialHeight,"y");cboxPublic.position(0);if(isIE6){$window.bind("resize.cboxie6 scroll.cboxie6",function(){$overlay.css({width:$window.width(),height:$window.height(),top:$window.scrollTop(),left:$window.scrollLeft()});}).trigger("scroll.cboxie6");}}$current.add($prev).add($next).add($slideshow).add($title).hide();$close.html(settings.close).show();cboxPublic.slideshow();cboxPublic.load();}cboxPublic=$.fn.ssoColorbox=function(options,callback){var $this=this;if(!$this.length){if($this.selector===""){$this=$("<a/>");options.open=TRUE;}else{return this;}}$this.each(function(){var data=$.extend({},$(this).data(colorbox)?$(this).data(colorbox):defaults,options);$(this).data(colorbox,data).addClass("cboxElement");if(callback){$(this).data(colorbox).onComplete=callback;}});if(options&&options.open){launch($this);}return this;};cboxPublic.init=function(){function $div(id){return $('<div id="sso-cbox-'+id+'"/>');}$window=$(window);$cbox=$('<div id="sso-cbox"/>');$overlay=$div("overlay").hide();$wrap=$div("wrapper");$content=$div("content").append($loaded=$div("loaded-content").addClass("clearfix").css({width:0,height:0}),$loadingOverlay=$div("loading-overlay"),$loadingGraphic=$div("loading-graphic"),$title=$div("title"),$current=$div("current"),$slideshow=$div("slideshow"),$next=$div("next"),$prev=$div("previous"),$close=$div("close"));$wrap.append($('<div id="sso-cbox-top-corners"/>').append($div("top-left"),$topBorder=$div("top-center"),$div("top-right")),$("<div/>").append($leftBorder=$div("middle-left"),$content,$rightBorder=$div("middle-right")),$('<div id="sso-cbox-bottom-corners"/>').append($div("bottom-left"),$bottomBorder=$div("bottom-center"),$div("bottom-right"))).children().children().css({"float":"left"});$loadingBay=$("<div style='position:absolute; top:0; left:0; width:9999px; height:0;'/>");$("body").append($overlay,$cbox.append($wrap,$loadingBay));if(isIE){$cbox.addClass("cbox-ie");if(isIE6){$overlay.css("position","absolute");}}$content.children().bind("mouseover mouseout",function(){$(this).toggleClass(hover);}).addClass(hover);interfaceHeight=$topBorder.height()+$bottomBorder.height()+$content.outerHeight(TRUE)-$content.height();interfaceWidth=$leftBorder.width()+$rightBorder.width()+$content.outerWidth(TRUE)-$content.width();loadedHeight=$loaded.outerHeight(TRUE);loadedWidth=$loaded.outerWidth(TRUE);$cbox.css({"padding-bottom":interfaceHeight,"padding-right":interfaceWidth}).hide();$next.click(cboxPublic.next);$prev.click(cboxPublic.prev);$close.click(cboxPublic.close);$content.children().removeClass(hover);$(".sso-cbox-element").live("click",function(e){if(e.button!==0&&typeof e.button!=="undefined"){return TRUE;}else{launch(this);return FALSE;}});};cboxPublic.position=function(speed,loadedCallback){var animate_speed,winHeight=$window.height(),posTop=Math.max(winHeight-settings.h-loadedHeight-interfaceHeight,0)/2+$window.scrollTop(),posLeft=Math.max(document.documentElement.clientWidth-settings.w-loadedWidth-interfaceWidth,0)/2+$window.scrollLeft();animate_speed=($cbox.width()===settings.w+loadedWidth&&$cbox.height()===settings.h+loadedHeight)?0:speed;$wrap[0].style.width=$wrap[0].style.height="9999px";function modalDimensions(that){$topBorder[0].style.width=$bottomBorder[0].style.width=$content[0].style.width=that.style.width;$loadingGraphic[0].style.height=$loadingOverlay[0].style.height=$content[0].style.height=$leftBorder[0].style.height=$rightBorder[0].style.height=that.style.height;}$cbox.dequeue().animate({width:settings.w+loadedWidth,height:settings.h+loadedHeight,top:posTop,left:posLeft},{duration:animate_speed,complete:function(){modalDimensions(this);active=FALSE;$wrap[0].style.width=(settings.w+loadedWidth+interfaceWidth)+"px";$wrap[0].style.height=(settings.h+loadedHeight+interfaceHeight)+"px";if(loadedCallback){loadedCallback();}},step:function(){modalDimensions(this);}});};cboxPublic.resize=function(object){if(!open){return;}var topMargin,prev,prevSrc,next,nextSrc,photo,timeout,speed=settings.transition==="none"?0:settings.speed;$window.unbind(cbox_resize);if(!object){timeout=setTimeout(function(){var $child=$loaded.wrapInner("<div style='overflow:auto'></div>").children();settings.h=$child.height();$loaded.css({height:settings.h});$child.replaceWith($child.children());cboxPublic.position(speed);},1);return;}$loaded.remove();$loaded=$('<div id="sso-cbox-loaded-content"/>').html(object);function getWidth(){settings.w=settings.w||$loaded.width();settings.w=settings.mw&&settings.mw<settings.w?settings.mw:settings.w;return settings.w;}function getHeight(){settings.h=settings.h||$loaded.height();settings.h=settings.mh&&settings.mh<settings.h?settings.mh:settings.h;return settings.h;}$loaded.hide().appendTo($loadingBay).css({width:getWidth(),overflow:settings.scrolling?"auto":"hidden"}).css({height:getHeight()}).prependTo($content);$("#sso-cbox-photo").css({cssFloat:"none"});if(isIE6){$("select:not(#sso-colorbox select)").filter(function(){return this.style.visibility!=="hidden";}).css({visibility:"hidden"}).one(cbox_cleanup,function(){this.style.visibility="inherit";});}function setPosition(s){cboxPublic.position(s,function(){if(!open){return;}if(isIE){if(photo){$loaded.fadeIn(100);}$cbox[0].style.removeAttribute("filter");}if(settings.iframe){$loaded.append("<iframe id='sso-cbox-iframe'"+(settings.scrolling?" ":"scrolling='no'")+" name='iframe_"+new Date().getTime()+"' frameborder=0 src='"+settings.href+"' "+(isIE?"allowtransparency='true'":"")+" />");}$loaded.show();$title.show().html(settings.title);if($related.length>1){$current.html(settings.current.replace(/\{current\}/,index+1).replace(/\{total\}/,$related.length)).show();$next.html(settings.next).show();$prev.html(settings.previous).show();if(settings.slideshow){$slideshow.show();}}$loadingOverlay.hide();$loadingGraphic.hide();$.event.trigger(cbox_complete);if(settings.onComplete){settings.onComplete.call(element);}if(settings.transition==="fade"){$cbox.fadeTo(speed,1,function(){if(isIE){$cbox[0].style.removeAttribute("filter");}});}$window.bind(cbox_resize,function(){cboxPublic.position(0);});});}if((settings.transition==="fade"&&$cbox.fadeTo(speed,0,function(){setPosition(0);}))||setPosition(speed)){}if(settings.preloading&&$related.length>1){prev=index>0?$related[index-1]:$related[$related.length-1];next=index<$related.length-1?$related[index+1]:$related[0];nextSrc=$(next).data(colorbox).href||next.href;prevSrc=$(prev).data(colorbox).href||prev.href;if(isImage(nextSrc)){$("<img />").attr("src",nextSrc);}if(isImage(prevSrc)){$("<img />").attr("src",prevSrc);}}$("#sso-cbox-content").css("paddingBottom","0");};cboxPublic.load=function(){var href,img,setResize,resize=cboxPublic.resize;active=TRUE;element=$related[index];settings=$(element).data(colorbox);process();$.event.trigger(cbox_load);if(settings.onLoad){settings.onLoad.call(element);}settings.h=settings.height?setSize(settings.height,"y")-loadedHeight-interfaceHeight:settings.innerHeight?setSize(settings.innerHeight,"y"):FALSE;settings.w=settings.width?setSize(settings.width,"x")-loadedWidth-interfaceWidth:settings.innerWidth?setSize(settings.innerWidth,"x"):FALSE;settings.mw=settings.w;settings.mh=settings.h;if(settings.maxWidth){settings.mw=setSize(settings.maxWidth,"x")-loadedWidth-interfaceWidth;settings.mw=settings.w&&settings.w<settings.mw?settings.w:settings.mw;}if(settings.maxHeight){settings.mh=setSize(settings.maxHeight,"y")-loadedHeight-interfaceHeight;settings.mh=settings.h&&settings.h<settings.mh?settings.h:settings.mh;}href=settings.href;$loadingOverlay.show();$loadingGraphic.show();if(settings.inline){$('<div id="sso-cbox-inline-temp" />').hide().insertBefore($(href)[0]).bind(cbox_load+" "+cbox_cleanup,function(){$(this).replaceWith($loaded.children());});resize($(href));}else{if(settings.iframe){resize(" ");}else{if(settings.html){resize(settings.html);}else{if(isImage(href)){img=new Image();img.onload=function(){var percent;img.onload=null;img.id="sso-cbox-photo";$(img).css({margin:"auto",border:"none",display:"block",cssFloat:"left"});if(settings.scalePhotos){setResize=function(){img.height-=img.height*percent;img.width-=img.width*percent;};if(settings.mw&&img.width>settings.mw){percent=(img.width-settings.mw)/img.width;setResize();}if(settings.mh&&img.height>settings.mh){percent=(img.height-settings.mh)/img.height;setResize();}}if(settings.h){img.style.marginTop=Math.max(settings.h-img.height,0)/2+"px";}resize(img);if($related.length>1){$(img).css({cursor:"pointer"}).click(cboxPublic.next);}if(isIE){img.style.msInterpolationMode="bicubic";}};img.src=href;}else{$("<div />").appendTo($loadingBay).load(href,function(data,textStatus){if(textStatus==="success"){resize(this);}else{resize($("<p>Request unsuccessful.</p>"));}});}}}}};cboxPublic.next=function(){if(!active){index=index<$related.length-1?index+1:0;cboxPublic.load();}};cboxPublic.prev=function(){if(!active){index=index>0?index-1:$related.length-1;cboxPublic.load();}};cboxPublic.slideshow=function(){var stop,timeOut,className="sso-cbox-slideshow-";$slideshow.bind(cbox_closed,function(){$slideshow.unbind();clearTimeout(timeOut);$cbox.removeClass(className+"off "+className+"on");});function start(){$slideshow.text(settings.slideshowStop).bind(cbox_complete,function(){timeOut=setTimeout(cboxPublic.next,settings.slideshowSpeed);}).bind(cbox_load,function(){clearTimeout(timeOut);}).one("click",function(){stop();$(this).removeClass(hover);});$cbox.removeClass(className+"off").addClass(className+"on");}stop=function(){clearTimeout(timeOut);$slideshow.text(settings.slideshowStart).unbind(cbox_complete+" "+cbox_load).one("click",function(){start();timeOut=setTimeout(cboxPublic.next,settings.slideshowSpeed);$(this).removeClass(hover);});$cbox.removeClass(className+"on").addClass(className+"off");};if(settings.slideshow&&$related.length>1){if(settings.slideshowAuto){start();}else{stop();}}};cboxPublic.close=function(){$.event.trigger(cbox_cleanup);if(settings.onCleanup){settings.onCleanup.call(element);}open=FALSE;$(document).unbind("keydown.cbox_close keydown.cbox_arrows");$window.unbind(cbox_resize+" resize.cboxie6 scroll.cboxie6");$overlay.css({cursor:"auto"}).fadeOut("fast");$cbox.stop(TRUE,FALSE).fadeOut("fast",function(){$("#colorbox iframe").attr("src","about:blank");$loaded.remove();$cbox.css({opacity:1});try{bookmark.focus();}catch(er){}$.event.trigger(cbox_closed);if(settings.onClosed){settings.onClosed.call(element);}});};cboxPublic.element=function(){return $(element);};cboxPublic.settings=defaults;$(cboxPublic.init);}(jQuery));iVillage=window.iVillage||{omniEvent:function(){},siteName:"",gigya_api_key:"2_TAACrzG-_a9IkzLfWB3YsVoaBvKoZSfmy-eAfFSA0_XZPEk1Lpd5dWthUDHdRtu-"};var iV_SSO=(function(window,$){var ssoReady,htmlBase,uploadSwf,postPaths,getPaths,origEventTarget,origEventType,avatarOverlay,cropApi,chimeType,regNlid,userSocialData;var options={baseUrl:"/",proxyUrl:'',vertical:1,gigyaAPIURL:"//cdn.gigya.com/JS/socialize.js",gigyaConfig:{enabledProviders:"facebook,twitter,yahoo,messenger,google,aol",newUsersPendingRegistration:true},basicLoginParams:{buttonsStyle:"standard",hideGigyaLink:true,includeiRank:true,width:240,height:165,showTermsLink:false,showTooltips:true,headerText:"<ul><li class='sc social-sign-in'>Save time by using your existing account to sign in to iVillage.</li><li class='sc social-privacy'>We'll never share your information or post anything to your account without your permission.</li></ul>",sessionExpiration:0,pendingRegistration:true,lastLoginIndication:"welcome",lastLoginButtonSize:30,UIConfig:'<config><body><controls><snbuttons buttonsize="35"></snbuttons></controls></body></config>',cid:"iVillage",context:"iVillage",onLoad:function(eventObj){log("Gigya: Signin Plugin Loaded.");}},loginUIParams:{containerID:"loginOptionsBox",includeiRank:true,onError:function(eventObj){log("Gigya: Unable to load Plugin.",eventObj);showGigyaError(eventObj,options.loginUIParams.containerID);}},registrationUIParams:{containerID:"registrationOptionsBox",includeiRank:true,onError:function(eventObj){log("Gigya: Unable to load Plugin.");showGigyaError(eventObj,options.registrationUIParams.containerID);}},forgotPwdLoginUIParams:{containerID:"forgotOptionsBox",includeiRank:true,onError:function(eventObj){log("Gigya: Unable to load Plugin.");showGigyaError(eventObj,options.forgotPwdLoginUIParams.containerID);}},chimeLoginUIParams:{containerID:"chimeLoginBox",UIConfig:'<config><body><controls><snbuttons buttonsize="25"></snbuttons></controls></body></config>',lastLoginButtonSize:25,height:92,width:200,includeiRank:true,onError:function(eventObj){log("Gigya: Unable to load Plugin.");showGigyaError(eventObj,options.chimeLoginUIParams.containerID);}},globalLayoutLoginUIParams:{containerID:"globalLayoutLoginBox",headerText:"",lastLoginIndication:"border",context:"iVillageHeader",width:150,height:26,includeiRank:true,UIConfig:'<config><body><controls><snbuttons buttonsize="20"></snbuttons></controls></body></config>'},channelLayoutLoginUIParams:{containerID:"channelLayoutLoginBox",headerText:"",lastLoginIndication:"border",context:"iVillageHeader",width:150,height:26,includeiRank:true,UIConfig:'<config><body><controls><snbuttons buttonsize="20"></snbuttons></controls></body></config>'},addConnectionsUIParams:{containerID:"addConnectionsBox",width:135,height:26,hideGigyaLink:true,showTermsLink:false,includeiRank:true,UIConfig:'<config><body><controls><snbuttons buttonsize="20"></snbuttons></controls></body></config>',sessionExpiration:0,cid:"iVillage"},addConnectionsUISmallParams:{containerID:"addConnectionsBoxSmall",width:130,height:26,hideGigyaLink:true,showTermsLink:false,includeiRank:true,UIConfig:'<config><body><controls><snbuttons buttonsize="20"></snbuttons></controls></body></config>',sessionExpiration:0,cid:"iVillage"},addConnectionsUILoaded:false,loginUILoadindAttempts:0,loginUILoaded:false,addConnectionsUILoadindAttempts:0,registrationBoxExpanded:false,onLoginParams:{onLogin:function(eventObj){steps.gigyaLogin(eventObj);}},onConnectionEditParams:{onConnectionAdded:function(eventObj){editedConnection(eventObj);},onConnectionRemoved:function(eventObj){editedConnection(eventObj);}},loginParamsPassed:false,submitUGCForm:false,slide_information:{},gigya_share_ugc_config:{operationMode:"multiSelect",containerID:"ugc-gigya-share-plugin",context:"UGCShare",cid:"iVillage",shortURLs:"always",showTooltips:true,showMoreButton:false,showEmailButton:true}};var inited=false;var isAuthenticated=false;var userId=0;var avatarId=0;var username="";var sessionToken="";var flowType="login";var lastFlow="none";var flowSuccess=false;var uploadPhotoId=0;var saveURL="";var saveId="";var errorArrow='<span class="error-arrow"></span>';var proxyOrBase="";var completeUploads=0;$.validator.addMethod("not_default",function(value,element){return this.optional(element)||value!=="default";},errorArrow+"Please select an option.");$.validator.addMethod("us_check",function(value,element){if(parseInt($("#sso_country_id").val(),10)===1){$("#sso_zip_code").rules("add",{required:true,minlength:5,maxlength:5,messages:{required:errorArrow+"Please enter a valid 5 digit US zip code.",minlength:errorArrow+"Please enter a valid 5 digit US zip code.",maxlength:errorArrow+"Please enter a valid 5 digit US zip code."}});}else{$("#sso_zip_code").rules("remove");}return true;},errorArrow+"Enter a zip.");$.validator.addMethod("start_date_check",function(value,element){element=$(element);var selects;if(element.hasClass("start-date-required")){selects=element.parent().find("select");if(element.is(":checked")){selects.each(function(){var type=this.id.split("_")[0];$(this).rules("add",{not_default:true,messages:{not_default:errorArrow+"Please select a "+type+"."}});});}else{selects.each(function(){$(this).rules("remove");});}}return true;},errorArrow+"Enter a start date.");$.validator.addMethod("at_least_one",function(value,element){return $.find(":checkbox:checked").length>0;},errorArrow+'Please select the newsletters you\'d like to receive before clicking "Subscribe"');$.validator.addMethod("community_leader_check",function(value,element){var firstThree=value.substring(0,3);return firstThree!=="cl-"&&firstThree!=="cl_";},errorArrow+'Your username cannot begin with "cl-" or "cl_"');$.validator.addMethod("additional_field_validation",function(value,element){return $(element).parent().css("display")=="none"||value!="";},errorArrow+"This field is required.");$.validator.addMethod("additional_field_length",function(value,element){return $(element).parent().css("display")=="none"||value.length<51;},errorArrow+"Should not be more than 50 characters.");$.validator.addMethod("selected_ugc_category",function(value,element){if($("#sso-upload #ugc_categorization_group").find("input[type=radio]:checked").length==0){if($("#sso-upload #ugc_categorization_group span.error").length>0){$("#sso-upload #ugc_categorization_group span.error").remove();}$("#sso-upload #ugc_categorization_group").append("<span class='error' style='line-height: 120%'>Please select one category.</span>");return false;}else{return true;}},"");var validation={login:{rules:{sso_email_username:{required:true},sso_password:{required:true}},messages:{sso_email_username:{required:errorArrow+"Please enter your email or username."},sso_password:{required:errorArrow+"Please provide a password."}},invalidHandler:function(){setTimeout(omnitureSignInErrors,100);}},register:{rules:{sso_email:{required:true,email:true},sso_username:{required:true,community_leader_check:true},sso_password:{required:true,minlength:4},sso_confirm_password:{required:true,equalTo:"#sso_password"},sso_dob_month:{not_default:true},sso_dob_day:{not_default:true},sso_dob_year:{not_default:true},sso_country_id:{not_default:true,us_check:true},sso_zip_code:{required:true},sso_terms:{required:true}},messages:{sso_username:{required:errorArrow+"Please enter a username."},sso_password:{required:errorArrow+"Please provide a password.",minlength:errorArrow+"Please choose at least 4 characters."},sso_confirm_password:{required:errorArrow+"Please provide a password.",equalTo:errorArrow+"Please enter the same password as above."},sso_dob_month:{not_default:errorArrow+"Please select your birth month."},sso_dob_day:{not_default:errorArrow+"Please select your birth day."},sso_dob_year:{not_default:errorArrow+"Please select your birth year."},sso_country_id:{not_default:errorArrow+"Please select your country."},sso_zip_code:{required:errorArrow+"Please enter a valid 5 digit US zip code."},sso_email:errorArrow+"Please enter a valid email address.",sso_terms:errorArrow+"Required."},invalidHandler:function(){setTimeout(omnitureRegistrationErrors,100);}},gigya_register:{rules:{sso_email:{required:true,email:true},sso_username:{required:true,community_leader_check:true},sso_password:{required:true,minlength:4},sso_confirm_password:{required:true,equalTo:"#sso_password2"},sso_dob_month:{not_default:true},sso_dob_day:{not_default:true},sso_dob_year:{not_default:true},sso_country_id:{not_default:true,us_check:true},sso_zip_code:{required:true},sso_terms:{required:true}},messages:{sso_username:{required:errorArrow+"Please enter a username."},sso_password:{required:errorArrow+"Please provide a password.",minlength:errorArrow+"Please choose at least 4 characters."},sso_confirm_password:{required:errorArrow+"Please provide a password.",equalTo:errorArrow+"Please enter the same password as above."},sso_dob_month:{not_default:errorArrow+"Please select your birth month."},sso_dob_day:{not_default:errorArrow+"Please select your birth day."},sso_dob_year:{not_default:errorArrow+"Please select your birth year."},sso_country_id:{not_default:errorArrow+"Please select your country."},sso_zip_code:{required:errorArrow+"Please enter a valid 5 digit US zip code."},sso_email:errorArrow+"Please enter a valid email address.",sso_terms:errorArrow+"Required."},invalidHandler:function(){setTimeout(omnitureGigyaRegistrationErrors,100);}},fb_link_existing:{rules:{sso_email:{required:true,email:true},sso_username:{required:true,community_leader_check:true},sso_password:{required:true,minlength:4},sso_confirm_password:{required:true,equalTo:"#sso_password3"},sso_dob_month:{not_default:true},sso_dob_day:{not_default:true},sso_dob_year:{not_default:true},sso_country_id:{not_default:true,us_check:true},sso_zip_code:{required:true},sso_terms:{required:true}},messages:{sso_username:{required:errorArrow+"Please enter a username."},sso_password:{required:errorArrow+"Please provide a password.",minlength:errorArrow+"Please choose at least 4 characters."},sso_confirm_password:{required:errorArrow+"Please provide a password.",equalTo:errorArrow+"Please enter the same password as above."},sso_dob_month:{not_default:errorArrow+"Please select your birth month."},sso_dob_day:{not_default:errorArrow+"Please select your birth day."},sso_dob_year:{not_default:errorArrow+"Please select your birth year."},sso_country_id:{not_default:errorArrow+"Please select your country."},sso_zip_code:{required:errorArrow+"Please enter a valid 5 digit US zip code."},sso_email:errorArrow+"Please enter a valid email address.",sso_terms:errorArrow+"Required."},invalidHandler:function(){setTimeout(omnitureGigyaRegistrationErrors,100);}},chime:{rules:{sso_guest_name:{required:"#sso_guest_email:filled"},sso_guest_email:{email:true,required:"#sso_guest_name:filled"},sso_member_email:{email:true},sso_member_password:{required:"#sso_email_username:filled"}},messages:{sso_guest_name:{required:errorArrow+"Please enter your name."},sso_guest_email:{email:errorArrow+"Please enter a valid email address.",required:errorArrow+"Please enter an email address."},sso_member_email:{email:errorArrow+"Please enter a valid email address."},sso_member_password:{required:errorArrow+"Please enter your password."}}},social_email:{rules:{sso_social_email:{required:true,email:true}},messages:{sso_social_email:{required:errorArrow+"Please enter your email address.",email:errorArrow+"Please enter a valid email address."}}},ugc_upload:{rules:{title:{required:true,maxlength:50},description:{required:true,maxlength:140},additional_optin:{required:true},sso_additional_field_1:{additional_field_validation:true,additional_field_length:true},sso_additional_field_2:{additional_field_validation:true,additional_field_length:true},ugc_categories:{selected_ugc_category:true}},messages:{title:{required:errorArrow+"Please provide a title for this image.",maxlength:errorArrow+"Title should not be more than 50 characters."},description:{required:errorArrow+"Please describe this image in brief.",maxlength:errorArrow+"Descripiton should not be more than 140 characters."},additional_optin:{required:errorArrow+"Please accept the terms and conditions."}}}};var steps={addSave:function(e){log("steps.addSave()");requestHTML("addSave",function(){$("#sso-cbox-close").show();$("#sso-add-save .buttons a").click(handleAddSave);});},deleteSave:function(e){log("steps.deleteSave()");requestHTML("deleteSave",function(){$("#sso-cbox-close").show();$("#sso-delete-save #delete-save").click(handleDeleteSave);$("#sso-delete-save a.btn-nope").click(function(e){e.preventDefault();closeAfter(0);});});},editSave:function(e){log("steps.editSave()");requestHTML("editSave",function(){$("#sso-cbox-close").show();$("#sso-add-save a#edit-save").click(handleEditSave);});},insertSave:function(e){log("steps.insertSave()");requestHTML("insertSave",function(){$("#sso-cbox-close").show();$("#save-insert-list li").click(embedSaveToTextarea);});},login:function(){log("steps.login()");if(!isAuthenticated){requestHTML("login",function(){if(typeof(gigya)!="undefined"){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.loginUIParams));}else{var list=$("#sso-cbox-loaded-content div.social-connect > ul.error-list");displayErrors(list,{message:"Connecting via social networks is not available at the moment. Please use normal login option."});}$("#sso-cbox-close").show();$("#sso-sign-in").validate(validation.login);customOmniEvent(null,25,"Start sign-in process.");});}},gigyaLogin:function(eventObj){log("steps.gigyaLogin() > Start Authentication",eventObj);var omniVerticalMsg="gigyasignin_"+iVillage.siteName;omniVerticalMsg=omniVerticalMsg.toLowerCase();iVillage.omniEvent(null,null,"Start sign-in/registration process VIA Gigya.",omniVerticalMsg);$.ajax({type:"POST",url:postPaths.gigyaLogin,cache:false,data:{vertical:options.vertical,data:eventObj},dataType:"json",error:function(data){log("steps.gigyaLogin() error!",data);var list=$("#sso-cbox-loaded-content div.social-connect > ul");displayErrors(list,{message:"We're sorry, but we were unable to connect you with "+eventObj.provider+" at this time. Please try again later."});omnitureSignInErrors(true);},success:function(data){log("steps.gigyaLogin() > Success received from server!");userSocialData=eventObj;if(data.success){if(data.new_registration){if(typeof(data.new_email_id)!="undefined"&&data.new_email_id!=""){steps.registerNewUser(eventObj);}else{steps.askForEmail(eventObj,data);}}else{if(typeof(data.matched_id)!="undefined"&&data.matched_id){flowSuccess=true;if(eventObj.context=="iVillageHeader"){location.reload();}else{closeAfter(0);if(flowType==="chime"){triggerChimeEvent({type:"member"});}}}else{if(typeof(data.is_fb_user)!="undefined"&&data.is_fb_user){steps.linkExistingFBUser(eventObj,data);}else{steps.askForPassword(eventObj,data);}}}}else{log("steps.gigyaLogin() error!",data);var list=$("#sso-cbox-loaded-content div.social-connect > ul");displayErrors(list,{message:"We're sorry, but we were unable to connect you with "+eventObj.provider+" at this time. Please try again later."});omnitureSignInErrors(true);}}});},registerNewUser:function(eventObj,user_email){log("steps.registerNewUser()");requestHTML("gigyaRegister",function(){var custom_message="You're almost done. Fill in the fields below to complete your registration.";var fill_gigya_register_form=fillUserInfoHeader(eventObj,"link-or-register-forms",custom_message);fill_gigya_register_form=fillGigyaRegisterForm(eventObj,user_email);$("#sso-cbox-close").show();$("#sso-gigya-register").validate(validation.gigya_register);customOmniEvent(null,54,"Reg Missing Request");setTimeout(function(){$.fn.ssoColorbox.resize();},100);});},askForEmail:function(eventObj,data){log("steps.askForEmail()");if(flowType=="chime"){lastFlow="chime";}flowType="emailLookup";requestHTML("askForEmail",function(){var custom_message="Please provide your email address to complete your registration.";var fill_email_lookup_form=fillUserInfoHeader(eventObj,"ask-social-email",custom_message);$("#sso-social-get-email").find('input[name="email_lookup"]').val(1);$("#sso-cbox-close").show();$("#sso-social-get-email").validate(validation.social_email);customOmniEvent(null,52,"Reg Email Request");$.fn.ssoColorbox.resize();});},askForPassword:function(eventObj,data){log("steps.askForPassword()");if(flowType=="chime"){lastFlow="chime";}flowType="linkingAccounts";requestHTML("askForPassword",function(){var custom_message="We found an existing iVillage account for <strong>"+data.user.primary_email+"</strong>. Please enter your password to link your accounts and finish logging in.";var fill_password_form=fillUserInfoHeader(eventObj,"link-or-register-forms",custom_message);fill_password_form=fillAccountLinkForm(eventObj);$("#sso-ask-for-password").find('input[name="sso_email_username"]').val(data.user.primary_email).parents("li").hide();$("#sso-cbox-close").show();$("#sso-ask-for-password").validate(validation.login);customOmniEvent(null,53,"Reg Password Request");$.fn.ssoColorbox.resize();});},finalizeLinking:function(data){log("steps.finalizeLinking() > Accounts linked. Completing login process.");flowSuccess=true;closeAfter(0);if(flowType==="chime"||lastFlow=="chime"){triggerChimeEvent({type:"member"});}},linkExistingFBUser:function(eventObj,data){log("steps.linkExistingFBUser() > User was in iVillage via FB connect");if(flowType=="chime"){lastFlow="chime";}flowType="linkingAccounts";requestHTML("linkExistingFBUser",function(){var custom_message="You're almost done. Fill in the fields below to complete your registration.";var fill_password_form=fillUserInfoHeader(eventObj,"link-or-register-forms",custom_message);fill_password_form=fillFBAccountLinkForm(eventObj);if(!data.ask_for_email){$("#sso-link-existing-fb-user").find('input[name="sso_email"]').val(data.user.primary_email).parents("li").hide();}else{if(typeof(data.new_email_id)!="indefined"&&data.new_email_id!=""){$("#sso-link-existing-fb-user").find('input[name="sso_email"]').val(data.new_email_id).parents("li").hide();}}$("#sso-link-existing-fb-user").find('input[name="id"]').val(data.user.id);$("#sso-cbox-close").show();$("#sso-link-existing-fb-user").validate(validation.fb_link_existing);customOmniEvent(null,54,"Reg Missing Request");$.fn.ssoColorbox.resize();});},socialGetEmail:function(){requestHTML("socialGetEmail",function(){$("#sso-cbox-close").hide();$("#sso-social-get-email").validate(validation.social_email);});},forgotPassword:function(){log("steps.forgotPassword()");if(!isAuthenticated){requestHTML("forgotPassword",function(){if(typeof(gigya)!="undefined"){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.forgotPwdLoginUIParams));}else{var list=$("#sso-cbox-loaded-content div.social-connect > ul.error-list");displayErrors(list,{message:"Connecting via social networks is not available at the moment. Please use normal login option."});}$("#sso-cbox-close").show();});}},logout:function(){log("steps.logout()");function logoutPost(){$.ajax({type:"POST",url:postPaths.logout,cache:false,error:ajaxError,success:function(data,status,XHR){log("steps.logout() > Returned from server.",data);isAuthenticated=false;userId=0;flowSuccess=true;fireOriginalEventOrReload();}});}log("steps.logout() Authenticated, logging out...");if(typeof(gigya)!="undefined"){log("steps.logout() Logging out with Gigya...");options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});var logoutParams={callback:function(responseObj){logoutPost();},forceProvidersLogout:true};gigya.services.socialize.logout(options.gigyaConfig,logoutParams);$(".add_connection_edit_btn").fadeOut("slow");}else{log("steps.logout() Logging out without Gigya...");logoutPost();}},register:function(){log("steps.register()");if(!isAuthenticated){requestHTML("register",function(){if(typeof(gigya)!="undefined"){if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.registrationUIParams));}else{var list=$("#sso-cbox-loaded-content div.social-connect > ul.error-list");displayErrors(list,{message:"Connecting via social networks is not available at the moment. Please use normal login option."});}$('[name="sso_confirm_password"]').live("focusin",function(e){if(!options.registrationBoxExpanded){e.preventDefault();var need_resize=displayHiddenFields("#sso-register","li");setTimeout(function(){$.fn.ssoColorbox.resize();},500);$(this).focus();options.registrationBoxExpanded=true;}});$("#sso-cbox-close").show();$("#sso-register").validate(validation.register);$("#sso-register").find('input[type="text"], input[type="password"]').keypress(function(e){var code=e.keyCode||e.which;if(code===13){$("#sso-register").submit();}});filterLoginMessage(false);customOmniEvent(null,20,"Start registration flow");});}},chime:function(){log("steps.chime()");if(!isAuthenticated){requestHTML("chime",function(){if(typeof(gigya)!="undefined"){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.chimeLoginUIParams));}else{var list=$("#sso-cbox-loaded-content div.social-connect > ul.error-list");displayErrors(list,{message:"Connecting via social networks is not available at the moment. Please use normal login option."});}$("#sso-cbox-close").show();$("#sso-chime-in").validate(validation.chime);});}},avatarOrUpload:function(that){log("steps.avatarOrUpload()");if(isAuthenticated){requestHTML("avatarOrUpload",function(){$("#sso-cbox-close").show();});}else{steps.login();}},allAvatars:function(that){log("steps.allAvatars()");if(isAuthenticated){requestHTML("allAvatars",function(){$("#sso-cbox-close").show();});}else{steps.login();}},uploadPhoto:function(that,isAvatar){isAvatar=isAvatar||false;var getPath=isAvatar?"uploadAvatar":"uploadPhoto";var postPath=postPaths.createPhoto;log("steps.uploadAvatar()",[that,isAvatar]);if(isAuthenticated){requestHTML(getPath,function(){$("#sso-cbox-close").show();var cancel=$("#sso-submit-photo a.btn-cancel.sso-close");$("#sso-upload input[type='file']").uploadify({uploader:uploadSwf,width:65,height:25,script:postPath,fileDataName:"photo",sizeLimit:2500000,scriptData:{token:sessionToken},cancelImg:options.baseUrl+"public/sso/images/cancel.png",buttonImg:options.baseUrl+"public/sso/images/btn-browse-for-flash.png",auto:true,fileExt:"*.gif;*.jpg;*.jpeg;*.png",fileDesc:"Choose a picture to upload.",onSelect:function(event,queueID,fileObj){cancel.addClass("btn-hide");$("#sso-cbox-close").hide();},onError:function(a,b,c,d){cancel.removeClass("btn-hide");$("#sso-cbox-close").show();},onComplete:function(event,queueID,fileObj,response){log("uploadify > onComplete()");establishSession(function(){response=$.parseJSON(response);uploadPhotoId=response.photo_id;$("#sso_photo_id").val(uploadPhotoId);finalizePhotoUpload(response.url,event,queueID,fileObj,response);});},onAllComplete:function(){log("uploadify > onAllComplete()");completeUploads=0;}});});}else{steps.login();}},uploadAvatar:function(that){log("steps.uploadAvatar()");this.uploadPhoto(that,true);},thanks:function(){log("steps.thanks()");if(isAuthenticated){avatarOverlayCleanup();}requestHTML("thanks",function(){$("#sso-cbox-close").show();});},newslettersByVertical:function(){log("steps.newslettersByVertical()");if(isAuthenticated||(typeof(newsletterOverride)!="undefined")){requestHTML("newsletterList",function(){$("#sso-cbox-close").show();if(flowType==="register"){var eventArray;if($.isArray(regNlid)&&regNlid.length>0){eventArray=[22,23,24];iVillage.omniEvent(31,eventArray,"Registration completed, newsletter signups, begin newsletter registration.",null,regNlid);}else{eventArray=[22,23];iVillage.omniEvent(null,eventArray,"Registration completed, begin newsletter registration.");}}else{iVillage.omniEvent(null,23,"Newsletter Intercept");}var form=$("#sso-newsletters");var validationSettings={rules:{email:{at_least_one:true,email:true}},messages:{email:{at_least_one:errorArrow+'Please select the newsletters you\'d like to receive before clicking "Subscribe"',email:errorArrow+"Please enter a valid email address."}}};if(form.length){form.find("input.start-date-required").each(function(){validationSettings.rules[this.id]={start_date_check:true};}).live("click",function(){$(this).closest("form").valid();});form.find("input.user-email").bind("focus",function(){if($(this).val()==$(this)[0].title){$(this).removeClass("default_text");$(this).val("");}});form.find("input.user-email").bind("blur",function(){if($(this).val()==""){$(this).addClass("default_text");$(this).val($(this)[0].title);}});if(form.find("input.user-email").length<=0){form.find("input[type=checkbox]").first().each(function(){validationSettings.rules[this.id]={at_least_one:true};});}form.validate(validationSettings);}});}else{steps.login();}},insertOrUploadPhoto:function(e){log("steps.insertOrUploadPhoto()");if(isAuthenticated){requestHTML("insertOrUploadPhoto",function(){$("#sso-cbox-close").show();});}else{steps.login();}},pickPhoto:function(){log("steps.pickPhoto()");if(isAuthenticated){requestHTML("pickPhoto",function(){$("#sso-cbox-close").show();});}else{steps.login();}},ugc_upload:function(){log("steps.ugc_upload()");if(typeof(ugc_data)!="undefined"&&typeof(ugc_data.permission)!="undefined"&&!ugc_data.permission){$.fn.ssoColorbox({title:"Welcome to iVillage!",html:"<div id='sso-cbox-intro' style='width: 400px; height: 100px;'><span class='error'>"+ugc_data.reason+"</span></div>",scrolling:false,onComplete:function(){closeAfter(7000);},overlayClose:false});return;}var postPath=postPaths.createUGCPhoto;var size_limit=2500000;var file_extension="*.gif;*.jpg;*.jpeg;*.png";var file_desc="Choose a picture to upload.";if(typeof(ugc_data)!="undefined"){size_limit=ugc_data.size_limit;file_extension=ugc_data.file_extension;file_desc=ugc_data.file_desc;}if(isAuthenticated){$("#ugc-preview-area a.sso-ugc-edit").unbind("click").live("click",function(e){e.preventDefault();options.submitUGCForm=false;steps.toggel_ugc_upload_form("upload");});requestHTML("uploadUGC",function(){updateUGCLayover("sso-upload-ugc");$.fn.ssoColorbox.resize();$("#sso-cbox-close").show();$("#sso-upload").validate(validation.ugc_upload);$("#sso-upload #ugc_categorization_group").find("input[type=radio]").change(function(){if($("#sso-upload #ugc_categorization_group span.error").length>0){$("#sso-upload #ugc_categorization_group span.error").remove();}});bind_uploadify_for_ugc_photo("sso-upload",postPath,size_limit,file_extension,file_desc);});}else{steps.login();}},toggel_ugc_upload_form:function(switch_option,form){log("steps.toggel_ugc_upload_form()",switch_option);if(typeof(switch_option)=="undefined"){return;}if(switch_option=="preview"){options.submitUGCForm=true;formData=form.serializeArray();log("formData:ugc_upload()",formData);hideUGCUploadError();if(typeof(ugc_data)!="undefined"){if(typeof(ugc_data.username)!="undefined"){var captionHeading=(ugc_data.ugc_caption_heading&&ugc_data.ugc_caption_heading!=undefined)?(ugc_data.ugc_caption_heading):"";}var ugcCaptionPresent=($(".ugc_caption").length>0)?true:false;if(!ugcCaptionPresent){var captionHeading=(ugc_data.ugc_caption_heading&&ugc_data.ugc_caption_heading!=undefined)?(ugc_data.ugc_caption_heading):"";$("#ugc-preview-area .ugc-preview-username").html("Uploaded by "+ugc_data.username+"<br/><br/><div class='ugc_caption'>"+captionHeading+"</div>");$("#ugc-preview-area .ugc-preview-username").html("Uploaded by "+ugc_data.username+"<br/>");}else{$("#ugc-preview-area .ugc-preview-username").html("Uploaded by "+ugc_data.username+"<br/>");}if(typeof(ugc_data.header_copy_preview_page)!="undefined"){$("#ugc-preview-header").html(ugc_data.header_copy_preview_page);}}for(var ii=0;ii<formData.length;ii++){switch(formData[ii].name){case"ugc_id":$("#ugc-preview-area .ugc-preview-image").html("<img alt='If you are seeing this message for more than 1 minute then please close this and try again.' src='/photo/get-for-ugc?photo_id="+formData[ii].value+"' />");options.slide_information.ugc_id=formData[ii].value;break;case"title":$("#ugc-preview-area .ugc-preview-photo-title").html(formData[ii].value);options.slide_information.title=formData[ii].value;break;case"description":$("#ugc-preview-area .ugc-preview-photo-desc").html(formData[ii].value);options.slide_information.description=formData[ii].value;break;}}if(typeof(ugc_data.sponsor_html)!="undefined"){$("#ugc-preview-area .ugc-sponsored-by").html(ugc_data.sponsor_html);}$("#sso-upload-ugc").hide();$("#ugc-preview-header").show();$("#ugc-preview-area").show();setTimeout(function(){$.fn.ssoColorbox.resize();},50);}else{if(switch_option=="upload"){options.submitUGCForm=false;hideUGCUploadError();$("#ugc-preview-header").hide();$("#ugc-preview-area").hide();$("#sso-upload-ugc").show();setTimeout(function(){$.fn.ssoColorbox.resize();},50);}else{if(switch_option=="share"){hideUGCUploadError();var final_image_url="/photo/get-for-ugc?photo_id="+options.slide_information.ugc_id;var poll_graphic_url="http://i.ivillage.com/ugc/hot_dad/poll_graphics.jpg";if(typeof(options.slide_information.image_url)!="undefined"&&options.slide_information.image_url!=""){final_image_url=options.slide_information.image_url;}$("#ugc-share-header").html(ugc_data.header_copy_thankyou_page);$("#ugc-share-area .ugc-share-image").html("<a class='anchor_with_delay' href='"+options.slide_information.full_url+"'><img alt='UGC Photo' src='"+final_image_url+"' /></a>");$("#ugc-share-area .ugc-share-username").html("Uploaded by "+ugc_data.username+"<br/><br/>"+ugc_data.ugc_caption_heading);$("#ugc-share-area .ugc-share-photo-title").html(options.slide_information.title);$("#ugc-share-area .ugc-share-photo-desc").html(options.slide_information.description);$("#ugc-share-area .ugc-share-poll-graphic").html("<a class='anchor_with_delay' href='"+options.slide_information.full_url+"'><img alt='UGC Photo' src='"+poll_graphic_url+"' /></a>");$("#ugc-share-area a.btn-finish").live("click",function(e){e.preventDefault();$("#ugc-share-area .ugc-share-image").html("<img alt='UGC Photo' src='"+final_image_url+"' />");$("#ugc-share-area .ugc-share-poll-graphic").html("<img alt='UGC Photo' src='"+poll_graphic_url+"' />");$("#ugc-share-area .ugc-waiting-area .waiting-countdown").css("color","#090").html("We are taking you to the Gallery. Your photo could take up to 5 minutes to appear").css("line-height","20px");console.log("page url",options.slide_information.full_url,"/node/"+ugc_data.slideshow_nid);window.location="/node/"+ugc_data.slideshow_nid;});if(typeof(ugc_data.sponsor_html)!="undefined"){$("#ugc-share-area .ugc-sponsored-by").html(ugc_data.sponsor_html);}if(typeof(gigya)!="undefined"){var user_action=new gigya.services.socialize.UserAction();user_action.setUserMessage("This is the user message");user_action.setTitle(options.slide_information.title);user_action.setLinkBack(options.slide_information.full_url);user_action.setDescription(ugc_data.share_description);user_action.addMediaItem({type:"image",src:final_image_url,href:"http://www.ivillage.com"});gigya.services.socialize.showShareUI(options.gigyaConfig,$.extend({userAction:user_action},options.gigya_share_ugc_config));}else{log("Gigya Undefined!!");}$("#sso-cbox-close, a.btn-cancel").unbind("click",deletePhoto);$("#sso-upload-ugc").hide();$("#ugc-preview-header").hide();$("#ugc-preview-area").hide();$("#ugc-share-header").show();$("#ugc-share-area").show();setTimeout(function(){$.fn.ssoColorbox.resize();},50);}}}},create_ugc_slide:function(form){hideUGCUploadError();switchButtonToLoading(form);submitData=form.serializeArray();submitData.push({name:"slideshow_nid",value:ugc_data.slideshow_nid});submitData.push({name:"ugc_nid",value:ugc_data.ugc_nid});submitData.push({name:"channel_tid",value:ugc_data.channel_tid});log("steps.create_ugc_slide()",submitData);$.ajax({type:"POST",url:postPaths.createUGCSlide,cache:false,data:submitData,dataType:"json",beforeSend:function(){form.find("div.buttons").hide();form.find("#ugc-preview-area .ugc-waiting-area .waiting-message").html("Preparing data for submission...");form.find("#ugc-preview-area .ugc-waiting-area").show();var target_element=$("#ugc-preview-area .ugc-waiting-area .waiting-countdown");},success:function(data){log("steps.create_ugc_slide() > Returned from server.",data);switchLoadingToButton(form);form.find("div.buttons").show();form.find("#ugc-preview-area .ugc-waiting-area").hide();if(data&&data.success){flowSuccess=true;options.slide_information.full_url=data.full_url;options.slide_information.image_url=data.slide_image_url;steps.toggel_ugc_upload_form("share",form);}else{if(data&&!data.success){showUGCUploadError(data.error);}}},error:function(){switchLoadingToButton(form);showUGCUploadError("Sorry, we are unable to accept your submission at this time due to technical issues. Please try again later.");form.find("div.buttons").show();form.find("#ugc-preview-area .ugc-waiting-area").hide();$.fn.ssoColorbox.resize();}});}};function ajaxError(XHR,status,error){if(typeof window.console==="object"&&"log" in window.console){window.console.log("There was a server error, please try again later.",error);}}function handleStep(e){e.preventDefault();var that=$(this);var which=that.attr("step");if($.isFunction(steps[which])){steps[which](that);}}function handleNewWindow(e){e.preventDefault();window.open(this.href);}function handleFormSubmitter(e){log("handleFormSubmitter()");e.preventDefault();$(this).parents("form").submit();}function handleAddSave(e){e.preventDefault();log("handleAddSave()");var postData={privacy_level:$("#sso-add-save #save-privacy").val(),url:saveURL};$("#sso-add-save form, #sso-add-save p.query").hide();$("#sso-add-save").append('<div class="ajax-load"></div>');$.fn.ssoColorbox.resize();$.ajax({type:"POST",url:postPaths.addSave,cache:false,data:postData,dataType:"json",error:ajaxError,success:function(data){log("handleAddSave() > Returned from server.",data);closeAfter(0);if($("#profile-private").length){$.event.trigger("saveChange");}saveURL="";}});}function handleDeleteSave(e){e.preventDefault();log("handleDeleteSave()");$("#sso-delete-save").children().hide();$("#sso-delete-save").append('<div class="ajax-load"></div>');$.fn.ssoColorbox.resize();$.ajax({type:"POST",url:postPaths.deleteSave,cache:false,data:{id:saveId,url:saveURL},dataType:"json",error:ajaxError,success:function(data){log("handleDeleteSave() > Returned from server.",data);closeAfter(0);if($("#profile-private").length){$.event.trigger("saveChange");}saveId=0;}});}function handleEditSave(e){e.preventDefault();log("handleEditSave()");$("#sso-add-save").children().hide();$("#sso-add-save").append('<div class="ajax-load"></div>');$.fn.ssoColorbox.resize();var privacy=$("#sso-add-save form select.privacy").val();$.ajax({type:"POST",url:postPaths.editSave,cache:false,data:{id:saveId,privacy_level:privacy},dataType:"json",error:ajaxError,success:function(data){log("handleEditSave() > Returned from server.",data);closeAfter(0);saveId=0;}});}function embedSaveToTextarea(e){e.preventDefault();saveId=$(this).find("#save-id").attr("rel");log("embedSaveToTextarea()");$.ajax({type:"POST",url:postPaths.embedSave,cache:false,data:{id:saveId},error:ajaxError,success:function(data){log("embedSaveToTextarea() > Returned from server.",data);closeAfter(0);saveId=0;var textarea=origEventTarget.parent().siblings("textarea");if(typeof tinyMCE==="object"){textarea.tinymce().execCommand("mceInsertContent",false,data);}else{textarea.append(data);}}});}function handleChooseAvatar(e){e.preventDefault();var id=parseInt($(this).attr("rel"),10);$.ajax({type:"POST",url:postPaths.setAvatar,cache:false,data:{photo_id:id},dataType:"json",error:ajaxError,success:function(data){log("handleChooseAvatar() > Returned from server.",data);if(data&&data.success){if(flowType!=="register"){flowSuccess=true;}steps.thanks();}}});}function handleAddAnotherPhoto(e){e.preventDefault();$("input#sso-upload-more").attr("value","1");$("form#sso-upload").submit();uploadPhotoId=0;}function handlePickPhoto(e){var photo_id=$(this).attr("rel");e.preventDefault();embedPhotoToTextarea(photo_id);closeAfter(0);}function handlePaginate(e){var url=this.href;var con=$("#sso-cbox-loaded-content");e.preventDefault();con.html('<div class="ajax-load">Loading ...</div>');$.fn.ssoColorbox.resize();$.ajax({url:url,cache:false,error:ajaxError,dataType:"html",success:function(data){con.html(data);$.fn.ssoColorbox.resize();}});}function handleFinish(e){e.preventDefault();var that=$(this);if(that.hasClass("btn-finish")){sendDates(closeAfter);}else{sendDates(function(){window.location=that.attr("href");});}}function handleClose(e){e.preventDefault();closeAfter();}function fireOriginalEventOrReload(){log("fireOriginalEventOrReload() > Flow complete.",[flowType,flowSuccess]);options.registrationBoxExpanded=false;if(flowSuccess&&flowType!=="chime"&&lastFlow!=="chime"){if(typeof(origEventTarget)!="undefined"&&origEventTarget.hasClass("sso-pass-thru")){log("fireOriginalEventOrReload() > Fire original event!",[origEventTarget,origEventType]);if(origEventTarget.is("a")){log("fireOriginalEventOrReload() > It was a link.");var href=origEventTarget.attr("href");if(href==="#"){window.location.reload(true);}else{window.location=origEventTarget.attr("href");}}else{log("fireOriginalEventOrReload() > It was another element type.");origEventTarget.trigger(origEventType);}}else{log("fireOriginalEventOrReload() > Reload.");var theurl=window.location.href;if(theurl.indexOf("avatarOrUpload=true")>0){var randomnum=(Math.random()*11);$(location).attr("href","/profile/private?"+randomnum);}else{/*window.location.reload(true);*/ window.location.href="/photo-contests/endless-summer/redirection/";}}}if(flowType==="chime"){closeAfter(20);}flowSuccess=false;flowType="none";}function log(str,vars){if(window.console&&window.console.log){var date=new Date();var hours=date.getHours().toString();var mins=date.getMinutes().toString();var secs=date.getSeconds().toString();var msecs=date.getMilliseconds().toString();hours=(hours.length===1)?"0"+hours:hours;mins=(mins.length===1)?"0"+mins:mins;secs=(secs.length===1)?"0"+secs:secs;msecs+=(msecs.length===1)?"    ":(msecs.length===2)?" ":"";str=hours+":"+mins+":"+secs+":"+msecs+" > SSO > "+str;if(vars){console.log(str,vars);}else{console.log(str);}}}function filterLoginMessage(login){if(origEventTarget.hasClass("sso-comment")){var head=$("#sso-cbox-intro h3");var para=$("#sso-cbox-intro p");var headerMsg,paraMsg;headerMsg="Want to post a comment? You need to be an iVillage member";if(login){paraMsg='Sign in below or log in through Social Providers. New around here? <a href="#" class="sso-register">Join now!</a>';}else{paraMsg='Be inspired, get advice, and find support from women with shared experiences. You can create<br />your very own iVillage user account or sign in through Social Provider. Already a member? <a href="#" class="sso-log-in">Sign in.</a>';}head.html(headerMsg);para.html(paraMsg);$.fn.ssoColorbox.resize();}}function createPhotoUrl(id,h,w){return options.baseUrl+"photo/get?photo_id="+id+"&height="+h+"&width="+w;}function switchButtonToLoading(form){form.find("div.buttons").hide().after('<div class="ajax-load">Loading...</div>');}function switchGigyaToLoading(){$("#sso-cbox-loaded-content").find("div#"+options.loginUIParams.containerID).hide().after('<div class="ajax-load">Loading...</div>');$.fn.ssoColorbox.resize();}function switchLoadingToButton(form){form.find("div.buttons").show().next().remove();}function switchLoadingToGigya(){$("#sso-cbox-loaded-content").find("div#"+options.loginUIParams.containerID).show().next().remove();$.fn.ssoColorbox.resize();}function closeAfter(msecs){if(typeof msecs==="number"&&msecs>0){setTimeout($.fn.ssoColorbox.close,msecs);}else{var theurl=window.location.href;if(theurl.indexOf("avatarOrUpload=true")>0){var randomnum=(Math.random()*11);$(location).attr("href","/profile/private#?"+randomnum);}else{$.fn.ssoColorbox.close();}}}function serializedArrayToObject(data){var finalData={};for(var i=0;i<data.length;i++){finalData[data[i].name]=data[i].value;}return finalData;}function displayErrors(list,data){log("displayErrors()",[list,data]);removeErrors(list);if(data.message.length>0){list.prepend('<li class="error">'+data.message+"</li>");}if(typeof data.errors==="object"){$.each(data.errors,function(key,value){log("data.errors",[key,value]);var input=list.find("#"+key);if(input.length>0){var label=$('<label class="error">'+errorArrow+value+"</label>");var inputId=input.attr("id");if(inputId){label.attr("for",inputId);}input.addClass("error").after(label);}});}}function displaySuccess(list,data){log("displaySuccess()",[list,data]);removeErrors(list);if(data.message.length){list.prepend('<li class="success">'+data.message+"</li>");}closeAfter(4000);}function removeErrors(list){log("removeErrors()",list);list.find("li.error, label.error").remove();list.find("input.error").removeClass("error");}function getToken(){log("getToken()");if(typeof(iVillage)!="undefined"&&typeof(iVillage.arw_token)!="undefined"){isAuthenticated=true;userId=parseInt(iVillage.arw_person_id,10);avatarId=parseInt(iVillage.arw_avatar_id,10);username=iVillage.arw_username;if(sessionToken.length>23){}else{sessionToken=iVillage.arw_token;}}if(!ssoReady){ssoReady=true;setTimeout(function(){log("getToken() > Firing the sso.ready event.");$(document).trigger("sso.ready");},1000);}}function establishSession(callback,callonerror){log("establishSession()");$.ajax({type:"POST",url:postPaths.establishSession,cache:false,data:{token:sessionToken},dataType:"json",error:ajaxError,success:function(data){log("establishSession() > Returned from server.",data);isAuthenticated=data.success;if(data&&data.success){sessionToken=data.token;iVillage.arw_token=sessionToken;if($.isFunction(callback)){callback();}}else{if(data&&!data.success){if($.isFunction(callonerror)){callonerror(data);}}}}});}function requestHTML(which,complete){var url_params="?flow_type="+flowType+"&vertical="+options.vertical;var light_box_title="Welcome to iVillage!";if(flowType=="ugc-upload"){if(typeof(ugc_data)!="undefined"){if(typeof(ugc_data.lightbox_title)!="undefined"&&ugc_data.lightbox_title!=""){light_box_title=ugc_data.lightbox_title;}else{if(typeof(ugc_data.media_used)!="undefined"){light_box_title="Upload Your "+ugc_data.media_used;}else{light_box_title="Upload Your File";}}}else{light_box_title="Upload Your File";}}if(options.proxyUrl){url_params=escape(url_params);}log("requestHTML()",which,url_params);if(typeof getPaths[which]==="string"){$.ajax({type:"GET",url:getPaths[which]+url_params,cache:false,dataType:"html",error:ajaxError,success:function(data){if(data){$.fn.ssoColorbox({title:light_box_title,html:data,scrolling:false,onComplete:complete,overlayClose:false});}}});}}function formProcessor(e){log("submit");log("formProcessor()");e.preventDefault();var form=$(e.target);var id=form.attr("id");var name=form.attr("name");var submitData=form.serialize();switch(id){case"sso-sign-in":case"sso-ask-for-password":if(name==="forgot-password"){userForgotPassword(form,submitData);}else{userSignIn(form,submitData);}break;case"sso-register":flowType="register";userRegister(form,submitData);break;case"sso-gigya-register":if(flowType!="chime"){flowType="register";}userRegister(form,submitData,true);break;case"sso-link-existing-fb-user":userUpdateFBProfile(form,submitData);break;case"sso-newsletters":submitData=form.serializeArray();newsletterSignups(form,submitData);break;case"sso-chime-in":submitData=serializedArrayToObject(form.serializeArray());log("formProcessor() > sso-chime-in",submitData);if(submitData.sso_email_username&&submitData.sso_password){userSignIn(form,submitData);}else{guestChimeIn(form,submitData);}break;case"sso-upload":photoEdit(form);break;case"sso-social-get-email":submitSocialEmail(form,submitData);break;}}function userSignIn(form,submitData){log("userSignIn()",[form,submitData]);switchButtonToLoading(form);$.ajax({type:"POST",url:postPaths.login,cache:false,data:submitData,dataType:"json",success:function(data){log("userSignIn() > Returned from server.",data);isAuthenticated=data.success;if(data&&data.success){if(flowType==="login")
{iVillage.omniEvent(null,27,"Succesfully finish sign-in.");}userId=parseInt(data.person_id,10);avatarId=parseInt(data.photo_id,10);username=data.username;sessionToken=data.token;if(flowType==="login"||flowType==="register"){flowSuccess=true;closeAfter(0);}else{if(flowType==="chime"){flowSuccess=true;closeAfter(0);triggerChimeEvent({type:"member",dailyNews:submitData.sso_daily_newsletter==="on"?true:false});}else{if(flowType==="avatar"){steps.avatarOrUpload();}else{if(flowType==="newsletters"){steps.newslettersByVertical();}else{if(flowType==="linkingAccounts"){steps.finalizeLinking(data);}}}}}}else{if(flowType==="linkingAccounts"){displayErrors(form.find("fieldset.sso-ask-for-password > ol"),data);}else{displayErrors(form.find("fieldset.sso-sign-in > ol"),data);}omnitureSignInErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}},error:function(){displayErrors(form.find("fieldset.sso-sign-in > ol"),{message:"We're sorry, but we were unable to log you in at this time. Please try again later."});omnitureSignInErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}});}function userForgotPassword(form,submitData){log("userForgotPassword()",[form,submitData]);switchButtonToLoading(form);$.ajax({type:"POST",url:postPaths.forgotPassword,cache:false,data:submitData,dataType:"json",error:ajaxError,success:function(data){log("userForgotPassword() > Returned from server.",data);if(data&&data.success){displaySuccess(form.find("fieldset.sso-sign-in > ol"),data);}else{displayErrors(form.find("fieldset.sso-sign-in > ol"),data);}switchLoadingToButton(form);}});}function userRegister(form,submitData,is_gigya){log("userRegister()",[form,submitData]);switchButtonToLoading(form);var register_path=postPaths.register;if(typeof(is_gigya)!="undefined"&&is_gigya){log("userRegister() via gigya");register_path=postPaths.gigyaRegister;}$.ajax({type:"POST",url:register_path,cache:false,data:submitData,dataType:"json",success:function(data){log("userRegister() > Returned from server.",data);isAuthenticated=data.success;flowSuccess=data.success;if(data&&data.success){userId=parseInt(data.person_id,10);username=data.username;sessionToken=data.token;var daily=$("#sso_daily_newsletter");var offer=$("#sso_offers_promotions");if(daily.length||offer.length){regNlid=[];if(daily.is(":checked")){regNlid.push(6);}if(offer.is(":checked")){regNlid.push(68);}}if(flowType==="chime"||lastFlow=="chime"){flowSuccess=true;closeAfter(0);triggerChimeEvent({type:"member",dailyNews:submitData.sso_daily_newsletter==="on"?true:false});}else{steps.newslettersByVertical();}}else{displayErrors(form.find("fieldset > ol"),data);omnitureRegistrationErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}},error:function(){displayErrors(form.find("fieldset.sso-sign-in > ol"),{message:"We're sorry, but we were unable to create your account at this time. Please try again later."});omnitureRegistrationErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}});}function userUpdateFBProfile(form,submitData){log("userUpdateFBProfile()",[form,submitData]);switchButtonToLoading(form);$.ajax({type:"POST",url:postPaths.userUpdateFBProfile,cache:false,data:submitData,dataType:"json",success:function(data){log("userUpdateFBProfile() > Returned from server.",data);isAuthenticated=data.success;flowSuccess=data.success;if(data&&data.success){userId=parseInt(data.person_id,10);username=data.username;sessionToken=data.token;flowSuccess=true;closeAfter(0);if(flowType==="chime"||lastFlow=="chime"){triggerChimeEvent({type:"member"});}}else{displayErrors(form.find("fieldset > ol"),data);omnitureRegistrationErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}},error:function(){displayErrors(form.find("fieldset.sso-sign-in > ol"),{message:"We're sorry, but we were unable to update your account at this time. Please try again later."});omnitureRegistrationErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}});}function guestChimeIn(form,submitData){var errorData={};log("guestChimeIn()",[form,submitData]);switchButtonToLoading(form);if(submitData.sso_guest_email&&submitData.sso_guest_name){log("guestChimeIn() > Guest chime success!");closeAfter(0);triggerChimeEvent({type:submitData.sso_anonymous==="on"?"anon":"guest",guestName:submitData.sso_guest_name,guestEmail:submitData.sso_guest_email,dailyNews:submitData.sso_daily_newsletter==="on"?true:false});}else{errorData.message="If you choose not to log in, you must enter your name and email.";if(submitData.sso_anonymous){errorData.message+=" Although we won't display this information, it's still required.";}displayErrors(form.find("fieldset.chime-guest > ol"),errorData);switchLoadingToButton(form);$.fn.ssoColorbox.resize();}}function submitSocialEmail(form,submitData){log("submitSocialEmail()",[form,submitData]);switchButtonToLoading(form);$.ajax({type:"POST",url:postPaths.socialEmail,cache:false,data:submitData,error:ajaxError,dataType:"json",success:function(data){if(data&&data.valid){if(flowType=="emailLookup"){if(data.new_registration){steps.registerNewUser(userSocialData,data.new_email_id);}else{steps.askForPassword(userSocialData,data);}}else{if(flowType==="avatar"){steps.avatarOrUpload();}else{steps.newslettersByVertical();}}}else{displayErrors(form.find("ol"),{message:"Please provide a valid email address."});switchLoadingToButton(form);$.fn.ssoColorbox.resize();}}});}function triggerChimeEvent(extras){log("triggerChimeEvent() > sso."+chimeType,extras);$(document).trigger("sso."+chimeType,extras);}function newsletterSignups(form,submitData){log("newsletterSignups()",[form,submitData]);switchButtonToLoading(form);var buttons=$("#sso-newsletters div.buttons");var nothanks=buttons.find("a.btn-no-thanks");nothanks.hide();var error=false;var required=form.find("input.start-date-required");if(required.length){required.each(function(){var that,nl_id,li;if(error){return false;}that=$(this);nl_id=that.attr("id").replace("nl_","");if(that.is(":checked")){li=that.parent("li");nl_id=that.attr("id");li.find("select").each(function(){if($(this).val()==="default"){li.append('<label for="'+nl_id+'" generated="true" class="error"><span class="error-arrow"></span>Please provide a date</label>');switchLoadingToButton(form);nothanks.show();error=true;return false;}});}});}if(!error){submitData=prepareNewsletterData(submitData);log("newsletterSignups() > Final data.",submitData);$.ajax({type:"POST",url:postPaths.newsletterSignUp,cache:false,data:submitData,dataType:"json",error:ajaxError,success:function(data){if(data&&data.success){omnitureNewsletterEvent(submitData.newsletters,submitData.startDates);if(flowType==="chime"||lastFlow=="chime"){flowSuccess=true;closeAfter(0);triggerChimeEvent({type:"member",dailyNews:submitData.sso_daily_newsletter==="on"?true:false});}else{steps.thanks();}}else{switchLoadingToButton(form);nothanks.show();var nl_id=form.find('li:eq(0) input[type="checkbox"]').attr("id");buttons.append('<label for="'+nl_id+'" class="error" generated="true"><span class="error-arrow"></span>'+data.message+"</label>");error=true;return;}}});}}function prepareNewsletterData(data){var finalData={startDates:{},newsletters:[],funnelid:"",email:"",sourceid:0,verticalid:0};log("prepareNewsletterData()",data);$.each(data,function(i,item){var type=item.name.split("_")[0];var id=item.name.split("_")[1];if(type==="nl"){finalData.newsletters.push(item.value);}else{if(type==="email"){finalData.email=item.value;}else{if(type==="funnelid"){finalData.funnelid=item.value;}else{if(type==="sourceid"){finalData.sourceid=item.value;}else{if(type==="verticalid"){finalData.verticalid=item.value;}else{if(item.value!=="default"){finalData.startDates[id]=finalData.startDates[id]||{};finalData.startDates[id][type]=item.value;}}}}}}});return finalData;}function omnitureNewsletterEvent(newsletters,startDates){var omniIds=[];for(var i=0;i<newsletters.length;i++){var nlid=newsletters[i]*1;if(typeof(startDates[nlid])!=="undefined"&&typeof(startDates[nlid]["omni"])!=="undefined"){omniIds.push(startDates[nlid]["omni"]);}}iVillage.omniEvent(31,24,"Newsletter registration.",null,omniIds);}function avatarTelescope(e){var that=$(this);if(e.type==="mouseover"){that.data("over",true);setTimeout(function(){if(that.data("over")){avatarOverlayReveal(that);}},750);}else{that.data("over",false);}}function avatarOverlayReveal(that){var offset=that.offset();var outerWidth=that.outerWidth(true);var listOffset=that.parent().offset();var link=that.children("a");var photoId=parseInt(link.attr("rel"),10);var thumb=link.children("img");var bigLink=avatarOverlay.children("a");var bigThumb=new Image();var overlayCss={display:"block",top:offset.top-4,left:offset.left-4,opacity:0.5};bigLink.attr("name",":iv:registration:avatar-select");avatarOverlay.data("callerSize",outerWidth).data("alignLeft",true);if(outerWidth>60&&(offset.left-listOffset.left>268)){avatarOverlay.data("alignLeft",false);overlayCss.left-=154-outerWidth;}bigLink.empty();bigThumb.src=createPhotoUrl(photoId,150,150);bigThumb.onload=function(){bigLink.html(bigThumb);avatarOverlay.css("opacity",1);$(bigThumb).fadeIn("fast");};bigLink.attr("rel",photoId);avatarOverlay.css(overlayCss);}function avatarOverlayCheckPosition(e){var callerSize=avatarOverlay.data("callerSize");var outerWidth=avatarOverlay.outerWidth(true);var offset=avatarOverlay.offset();if(avatarOverlay.data("alignLeft")){if(e.pageX-offset.left>callerSize){avatarOverlayCleanup();}}else{if(offset.left+outerWidth-e.pageX>callerSize){avatarOverlayCleanup();}}if(e.pageY-offset.top>callerSize){avatarOverlayCleanup();}}function avatarOverlayCleanup(){avatarOverlay.hide().data("callerSize",0).data("alignLeft",true).data("over",false);avatarOverlay.children("a").empty();}function rotatePhoto(direction){log("rotatePhoto()",direction);var container=$("#sso-jcrop-container");var photoId=uploadPhotoId;var postData={photo_id:photoId,clockwise:direction};if(photoId){establishSession(function(){container.find("#sso-jcrop-target-img").remove();container.children().hide();container.find(".ajax-load").show();$.fn.ssoColorbox.resize();$.ajax({type:"POST",url:postPaths.rotatePhoto,cache:false,data:postData,dataType:"json",error:ajaxError,success:function(data){if(data&&data.success){if(flowType=="ugc-upload"){cleanUploadButtonForUploadify("sso-upload");}completeUploads=0;finalizePhotoUpload("/photo/get?photo_id="+photoId);}}});});}}function rotateClockwise(){rotatePhoto(1);}function rotateCounterClockwise(){rotatePhoto(0);}function deletePhoto(){log("deletePhoto()");establishSession(function(){if(uploadPhotoId!==0){$.ajax({type:"POST",url:postPaths.deletePhoto,cache:false,data:{photo_ids:{"0":uploadPhotoId}}});}if(flowType==="avatar"){steps.avatarOrUpload();}getToken();});}function finalizePhotoUpload(image_path){log("finalizePhotoUpload()",image_path);completeUploads++;if(completeUploads>1){log("finalizePhotoUpload() > completeUploads",completeUploads);return false;}$("#sso-cbox-close, a.btn-cancel").bind("click",deletePhoto);var container=$("#sso-jcrop-container");var cancel=$("#sso-upload a.btn-cancel");var controls=container.find("#sso-pic-controls");var loader=container.find(".ajax-load");var image=new Image();container.show();if(loader.length){loader.show();}else{controls.before('<div class="ajax-load"></div>');loader=container.find(".ajax-load");}$("#sso-jcrop-after").show();var stamp=new Date().getTime();image_path=options.baseUrl.replace(/\/$/,"")+image_path+"&"+stamp;log(image_path);$.fn.ssoColorbox.resize();image.id="sso-jcrop-target-img";image.onload=function(){var register=(flowType==="avatar"||flowType==="register");var cropHeight=register?160:image.height*0.95;var cropWidth=register?160:image.width*0.95;cancel.removeClass("btn-hide");$("#sso-cbox-close").show();loader.hide();controls.before(image).show();container.find("#sso-pic-controls").show();$.fn.ssoColorbox.resize();$("#sso-photo-details").fadeIn();cropApi=$.Jcrop("#sso-jcrop-target-img",{boxWidth:400,boxHeight:600,aspectRatio:register?1:"",setSelect:[10,10,cropWidth,cropHeight],allowSelect:false});if(flowType==="ugc-upload"){$("#sso-submit-ugc .sso-control-ugc").children().show();}else{$("#sso-submit-photo").children().show();}if(flowType==="insert-photo"){$("#sso-submit-photo #sso-upload-another").hide();}};image.src=image_path;return true;}function embedPhotoToTextarea(photo_id){var textarea=origEventTarget.parent().siblings("textarea");var string='<p><img src="/photo/get?photo_id='+photo_id+'" alt="" /></p>';if(window.tinyMCE){textarea.tinymce().execCommand("mceInsertContent",false,string);}else{textarea.append(string);}}function photoEdit(form){log("photoEdit()",form);if(flowType==="ugc-upload"){if(options.submitUGCForm&&$("#sso-upload-ugc").css("display")=="none"){steps.create_ugc_slide(form);return;}}var cropCoords=cropApi.tellSelect();var submitData={photo_id:uploadPhotoId,height:cropCoords.h,width:cropCoords.w,top:cropCoords.y,left:cropCoords.x,title:null,description:null};if(flowType!=="avatar"&&flowType!=="register"){submitData.title=$("input#sso_title").val();var subDesc=$("textarea#sso_description").val();subDesc=(subDesc.length>140)?subDesc.substring(0,140):subDesc;submitData.description=subDesc;}if(flowType=="ugc-upload"){submitData.privacy="hidden";}switchButtonToLoading(form);establishSession(function(){$.ajax({type:"POST",url:postPaths.cropAvatar,cache:false,data:submitData,dataType:"json",error:ajaxError,success:function(data){log("photoEdit() > Returned from server.",data);if(flowType==="avatar"||flowType==="register"){flowSuccess=true;setAvatar(uploadPhotoId,steps.thanks);}else{if(flowType==="insert-photo"){embedPhotoToTextarea(uploadPhotoId);closeAfter(0);}else{if(flowType==="ugc-upload"){switchLoadingToButton(form);steps.toggel_ugc_upload_form("preview",form);}else{if($("input#sso-upload-more").val()=="1"){steps.uploadPhoto();}else{closeAfter(0);window.location.reload(true);}}}}}});});}function setAvatar(id,callback){log("setAvatar()",[id,callback]);$.ajax({type:"POST",url:postPaths.setAvatar,cache:false,data:{photo_id:id},dataType:"json",error:ajaxError,success:function(data){log("setAvatar() > Returned from server.",data);if(data&&data.success){avatarId=parseInt(data.photo_id,10);if($.isFunction(callback)){callback();}}}});}function cloneBirthdayRow(e){log("cloneBirthdayRow()");e.preventDefault();var list=$("#sso-children > fieldset.child > ol");var items=list.children("li");var btnRow=list.children("li:last");var newLi=btnRow.prev().clone();newLi.children("select").each(function(){var that=$(this);var id=that.attr("id");var idArr=id.split("-");var name=that.attr("name");var nameArr=name.split("-");idArr[idArr.length-1]=items.length;that.attr("id",idArr.join("-"));nameArr[nameArr.length-1]=items.length;that.attr("name",nameArr.join("-"));});btnRow.before(newLi);$.fn.ssoColorbox.resize();}function prepareDates(data){log("prepareDates()",data);var finalData={birthdays:[],due_date:{}};$.each(data,function(itemIndex,item){var nameArr=item.name.replace("sso_","").split("_");var obj={};var index;if(nameArr[0]==="due"){finalData.due_date[nameArr[1]]=item.value;}else{if(nameArr[0]==="bday"){index=parseInt(nameArr[2],10)-1;if(finalData.birthdays[index]){finalData.birthdays[index][nameArr[1]]=item.value;}else{obj[nameArr[1]]=item.value;finalData.birthdays.push(obj);}}}});return finalData;}function sendDates(callback){log("sendDates()");var submitData=prepareDates($("#sso-children").serializeArray());$.ajax({type:"POST",url:postPaths.setChildren,cache:false,data:submitData,dataType:"json",error:ajaxError,success:function(data){log("sendDates() > Returned from server.",data);if(data&&data.success){if($.isFunction(callback)){callback();}}}});}function omnitureRegistrationErrors(){var form=$("#sso-register");var errors=form.find("label.error");var propCodes=[];var errorMap={sso_email:3,sso_username:4,sso_dob_year:8,sso_dob_day:9,sso_dob_month:10,sso_country_id:11,sso_zip_code:12,sso_terms:13};errors.each(function(){if($(this).is(":visible")){var labelFor=$(this).attr("for");if(errorMap[labelFor]!=="undefined"&&errorMap[labelFor]){propCodes.push(errorMap[labelFor]);}else{if(labelFor==="sso_password"){var val=$("#sso_password").val();if(val.length===0){propCodes.push(5);}else{if(val.length<4){propCodes.push(6);}}}else{if(labelFor==="sso_confirm_password"){var val=$("#sso_password").val();if(val.length>0){propCodes.push(7);}}}}}});iVillage.omniEvent(32,21,"Registration Error",null,propCodes);}function omnitureGigyaRegistrationErrors(){var form=$("#sso-gigya-register");var errors=form.find("label.error");var propCodes=[];var errorMap={sso_email:3,sso_username:4,sso_dob_year:8,sso_dob_day:9,sso_dob_month:10,sso_country_id:11,sso_zip_code:12,sso_terms:13};errors.each(function(){if($(this).is(":visible")){var labelFor=$(this).attr("for");if(errorMap[labelFor]!=="undefined"&&errorMap[labelFor]){propCodes.push(errorMap[labelFor]);}else{if(labelFor==="sso_password"){var val=$("#sso_password2").val();if(val.length===0){propCodes.push(5);}else{if(val.length<4){propCodes.push(6);}}}else{if(labelFor==="sso_confirm_password"){var val=$("#sso_password2").val();if(val.length>0){propCodes.push(7);}}}}}});iVillage.omniEvent(32,21,"Gigya Registration Error",null,propCodes);}function omnitureSignInErrors(gigyalogin){var form=$("#sso-sign-in");var errors=form.find("label.error");var propCodes=[];if(typeof gigyalogin!=="undefined"&&gigyalogin===true){propCodes.push(27);}var errorMap={sso_password:2};if(form.find("fieldset ol li:eq(0)").hasClass("error")){propCodes.push(1);}errors.each(function(){var labelFor=$(this).attr("for");if(errorMap[labelFor]!=="undefined"&&errorMap[labelFor]){propCodes.push(errorMap[labelFor]);}});iVillage.omniEvent(32,26,"Sign-in Error",null,propCodes);}function customOmniEvent(prop,events,message){var verticalMsg=null;var vertical=iVillage.siteName;if(vertical.length&&typeof vertical==="string"){vertical=vertical.toLowerCase();switch(events){case 20:verticalMsg="joinnow_";break;case 25:if(message.indexOf("gigyaconnect")!==-1){verticalMsg="gigyasignin_";}else{verticalMsg="signin_";}if(flowType==="forgot-password"){vertical="forgotpassword";}break;}verticalMsg=verticalMsg+vertical;}log("Firing Omniture Event");iVillage.omniEvent(prop,events,message,verticalMsg);}function fillAccountLinkForm(eventObj){$("#sso-ask-for-password").find('input[name="link_accounts"]').val("1");$("#sso-ask-for-password").find('input[name="uid"]').val(eventObj.UID);$("#sso-ask-for-password").find('input[name="provider"]').val(eventObj.provider);if(typeof(eventObj.user.firstName)!="undefined"){$("#sso-ask-for-password").find('input[name="first_name"]').val(eventObj.user.firstName);}if(typeof(eventObj.user.lastName)!="undefined"){$("#sso-ask-for-password").find('input[name="last_name"]').val(eventObj.user.lastName);}if(typeof(eventObj.user.gender)!="undefined"){$("#sso-ask-for-password").find('input[name="gender"]').val(eventObj.user.gender);}if(typeof(eventObj.user.birthYear)!="undefined"){$("#sso-ask-for-password").find('input[name="birthYear"]').val(eventObj.user.birthYear);}if(typeof(eventObj.user.birthMonth)!="undefined"){$("#sso-ask-for-password").find('input[name="birthMonth"]').val(eventObj.user.birthMonth);}if(typeof(eventObj.user.birthDay)!="undefined"){$("#sso-ask-for-password").find('input[name="birthDay"]').val(eventObj.user.birthDay);}$.fn.ssoColorbox.resize();return true;}function fillUserInfoHeader(eventObj,user_info_container,custom_message){var user_information="";if(typeof(eventObj.user.thumbnailURL)!="undefined"&&eventObj.user.thumbnailURL!=""){user_information+='<img src="'+eventObj.user.thumbnailURL+'" alt="User Thumbnail" />';}user_information+=" Welcome";if(typeof(eventObj.user.firstName)!="undefined"&&eventObj.user.firstName!=""){user_information+=", "+eventObj.user.firstName;}else{if(typeof(eventObj.user.email)!="undefined"&&eventObj.user.email!=""){user_information+=", "+eventObj.user.firstName;}}user_information+="! "+custom_message;$("."+user_info_container+" .user-information").html(user_information);$.fn.ssoColorbox.resize();return true;}function fillGigyaRegisterForm(eventObj,user_email){$("#sso-gigya-register").find('input[name="uid"]').val(eventObj.UID);$("#sso-gigya-register").find('input[name="provider"]').val(eventObj.provider);if(typeof(user_email)!="undefined"&&user_email!=""){$("#sso-gigya-register").find('input[name="sso_email"]').val(user_email).parents("li").hide();}else{if(typeof(eventObj.user.email)!="undefined"&&eventObj.user.email!=""){$("#sso-gigya-register").find('input[name="sso_email"]').val(eventObj.user.email).parents("li").hide();}}if(typeof(eventObj.user.gender)!="undefined"&&eventObj.user.gender!=""){$("#sso-gigya-register").find('[name="sso_gender"]').val(eventObj.user.gender).parents("li").hide();}if(typeof(eventObj.user.birthYear)!="undefined"&&typeof(eventObj.user.birthMonth)!="undefined"&&typeof(eventObj.user.birthDay)!="undefined"&&eventObj.user.birthYear!=""&&eventObj.user.birthMonth!=""&&eventObj.user.birthDay!=""){$("#sso-gigya-register").find('[name="sso_dob_year"]').val(eventObj.user.birthYear);$("#sso-gigya-register").find('[name="sso_dob_month"]').val(eventObj.user.birthMonth);$("#sso-gigya-register").find('[name="sso_dob_day"]').val(eventObj.user.birthDay).parents("li").hide();}if(typeof(eventObj.user.zip)!="undefined"&&eventObj.user.zip!=""){$("#sso-gigya-register").find('input[name="sso_zip_code"]').val(eventObj.user.zip);}$.fn.ssoColorbox.resize();return true;}function fillFBAccountLinkForm(eventObj){$("#sso-link-existing-fb-user").find('input[name="uid"]').val(eventObj.UID);$("#sso-link-existing-fb-user").find('input[name="provider"]').val(eventObj.provider);if(typeof(eventObj.user.gender)!="undefined"&&eventObj.user.gender!=""){$("#sso-link-existing-fb-user").find('[name="sso_gender"]').val(eventObj.user.gender).parents("li").hide();}if(typeof(eventObj.user.birthYear)!="undefined"&&typeof(eventObj.user.birthMonth)!="undefined"&&typeof(eventObj.user.birthDay)!="undefined"&&eventObj.user.birthYear!=""&&eventObj.user.birthMonth!=""&&eventObj.user.birthDay!=""){$("#sso-link-existing-fb-user").find('[name="sso_dob_year"]').val(eventObj.user.birthYear);$("#sso-link-existing-fb-user").find('[name="sso_dob_month"]').val(eventObj.user.birthMonth);$("#sso-link-existing-fb-user").find('[name="sso_dob_day"]').val(eventObj.user.birthDay).parents("li").hide();}if(typeof(eventObj.user.zip)!="undefined"&&eventObj.user.zip!=""){$("#sso-link-existing-fb-user").find('input[name="sso_zip_code"]').val(eventObj.user.zip);}$.fn.ssoColorbox.resize();return true;}function displayHiddenFields(container,element){var need_resize=false;log("displayHiddenFields()");$(container).find(element).each(function(){if($(this).css("display")=="none"){$(this).show("fast","linear");$.fn.ssoColorbox.resize();need_resize=true;}else{if($(this).hasClass("hide")){$(this).css("display","none").removeClass("hide").show("fast","linear");$.fn.ssoColorbox.resize();need_resize=true;}}});return need_resize;}function showGigyaError(eventObj,container){var errorMessage="";if(eventObj.errorCode!=0){switch(eventObj.errorCode){case"100001":case"500001":case"500002":errorMessage="Seems like server is busy at the moment. Please try again after some time.";break;case"200001":errorMessage="Login process canceled. Please try again.";break;case"200003":errorMessage="Please try again and grant social network permission.";break;case"400001":case"400002":case"400004":case"400006":case"400008":case"400011":case"400012":case"400013":case"400014":case"400015":errorMessage="Invalid Request. Please try again.";break;case"400050":errorMessage="Invalid user data returned. Please try again after some time.";break;case"400122":case"500023":errorMessage="There is some issue with the social provider you are trying to connect to. Please try login with different provider or try again after some time.";break;case"403001":case"403002":case"403009":case"403011":case"403012":case"403030":case"500014":case"500024":errorMessage="Session Expired. Please login again.";break;case"403007":errorMessage="Permission Denied. Please try again after some time.";break;case"500026":errorMessage="Network connection issue. Please try again.";break;case"504001":errorMessage="Connection timeout. Please try again.";break;case"500032":errorMessage="Unalbe to load gigya service at the moment. Please try again after some time.";break;default:errorMessage=eventObj.errorMessage;}if($("#sso-cbox span.error").length){$("#sso-cbox span.error").remove();}$("#"+container).html('<span class="error">'+errorMessage+"</span>"+$("#"+container).html());}}function editedConnection(eventObj){$.ajax({type:"POST",url:postPaths.editedConnection,cache:false,data:eventObj,dataType:"json",error:ajaxError,success:function(data){log("editedConnection() > Returned from server.",data);}});}function updateUGCLayover(containerID){var container_object=$("#"+containerID);log("updateUGCLayover()",container_object);if(container_object.length&&typeof(ugc_data)!="undefined"){if(typeof(ugc_data.caption_upload_box)!="undefined"&&ugc_data.caption_upload_box!=""){container_object.find(".ugc_location").html(ugc_data.caption_upload_box);}else{container_object.find(".ugc_location").html(ugc_data.media_used+" Location");}container_object.find(".upload_help_text").html(ugc_data.upload_help_text);if(typeof(ugc_data.additional_fields)!="undefined"){for(var key in ugc_data.additional_fields){$("label."+key).html(ugc_data.additional_fields[key]);$("input#"+key);$("input#"+key).parent().show();}}$(".sso_ugc_title").html(ugc_data.caption_image_title);$(".sso_ugc_description").html(ugc_data.caption_image_description);var category_select_boxes="";if(typeof(ugc_data.ugc_categories)!="undefined"){for(var key in ugc_data.ugc_categories){category_select_boxes+='<div style="float: left;"><input type="radio" id="ugc_category_'+key+'" name="ugc_categories" value="'+key+'" /> <label for="ugc_category_'+key+'">'+ugc_data.ugc_categories[key]+"</label></div>";}$(".ugc_categorization").show();$("#ugc_categorization_group").html(category_select_boxes);}if(typeof(ugc_data.terms_conditions)!="undefined"){$(".additional_optin").html('<ol><li><input type="checkbox" id="additional_optin" name="additional_optin" value="additional_optin" /> <label class="additional_option_label" for="additional_optin">'+ugc_data.terms_conditions+"</label></li></ol>");}}}function bind_uploadify_for_ugc_photo(container_id,post_path,size_limit,file_extension,file_desc){var cancel=$("#sso-submit-ugc a.btn-cancel.sso-close");$("#"+container_id+" input[type='file']").unbind().uploadify({uploader:uploadSwf,width:65,height:25,script:post_path,fileDataName:"photo",sizeLimit:size_limit,scriptData:{token:sessionToken},cancelImg:options.baseUrl+"public/sso/images/cancel.png",buttonImg:options.baseUrl+"public/sso/images/btn-browse-for-flash.png",auto:true,fileExt:file_extension,fileDesc:file_desc,onSelect:function(event,queueID,fileObj){cancel.addClass("btn-hide");$("#sso-cbox-close").hide();},onError:function(a,b,c,d){log("Uploadify error: ",[a,b,c,d]);showUGCUploadError("Sorry, we are unable to accept your submission at this time due to technical issues. Please try again later.");cancel.removeClass("btn-hide");$("#sso-cbox-close").show();},onComplete:function(event,queueID,fileObj,response){log("uploadify > onComplete()",response);establishSession(function(){response=$.parseJSON(response);uploadPhotoId=response.photo_id;$("#sso_ugc_id").val(uploadPhotoId);if(flowType=="ugc-upload"){cleanUploadButtonForUploadify(container_id);}finalizePhotoUpload(response.url,event,queueID,fileObj,response);},function(data){if(typeof(data)!="undefined"&&typeof(data.message)!="undefined"){if(data.message.indexOf("Token")!=-1&&data.message.indexOf("not valid")!=-1){showUGCUploadError("Sorry, we are unable to accept your submission at this time due to technical issues. Please logout and login again.");}else{showUGCUploadError("Sorry, we are unable to accept your submission at this time due to technical issues. Please try again later.");}cancel.removeClass("btn-hide");$("#sso-cbox-close").show();}});},onAllComplete:function(){log("uploadify > onAllComplete()");completeUploads=0;}});}function cleanUploadButtonForUploadify(container_id){if(!$.browser.msie){var input_box_id=$("#"+container_id+" input[type='file']").attr("id");var flash_var_to_update=$("#"+input_box_id+"Uploader param[name=flashvars]").attr("value");var dummy_param_array=flash_var_to_update.split("&");for(var count=0;count<dummy_param_array.length;count++){if(dummy_param_array[count].indexOf("scriptData")!=-1){dummy_param_array[count]="scriptData=token%3D"+sessionToken;}}$("#"+input_box_id+"Uploader param[name=flashvars]").attr("value",dummy_param_array.join("&"));var input_box_id=$("#"+container_id+" #sso-jcrop-container #sso-pic-controls").siblings().each(function(){$(this).remove();});}return;}function showUGCUploadError(ugc_error_detail){hideUGCUploadError();if(typeof(ugc_error_detail)=="undefined"){return;}$("#ugc-upload-errors").html("<p>"+ugc_error_detail+"</p>").show();$.fn.ssoColorbox.resize();}function hideUGCUploadError(){$("#ugc-upload-errors").html("").hide();$.fn.ssoColorbox.resize();}function initiateCountDown(container_id,settings,to){settings=jQuery.extend({startFontSize:"36px",endFontSize:"24px",duration:1000,startNumber:10,endNumber:0,callBack:function(){}},settings);if(!to&&to!=settings.endNumber){to=settings.startNumber;}container_id.text(to).css("fontSize",settings.startFontSize);container_id.animate({fontSize:settings.endFontSize},settings.duration,"",function(){if(container_id.parent().css("display")!="none"){if(to>settings.endNumber+1){container_id.css("fontSize",settings.startFontSize).text(to-1);initiateCountDown(container_id,settings,to-1);}else{settings.callBack();}}});}return{login:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="login";steps.login();}},gigyaLogin:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="gigyaLogin";steps.gigyaLogin();}},registerNewUser:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="gigyaRegister";steps.registerNewUser();}},askForEmail:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="emailLookup";steps.askForEmail();}},askForPassword:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="linkingAccounts";steps.askForPassword();}},linkExistingFBUser:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="linkingAccounts";steps.linkExistingFBUser();}},finalizeLinking:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();steps.finalizeLinking();}},forgotPassword:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="forgot-password";steps.forgotPassword();}},logout:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="logout";steps.logout();},register:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="register";steps.register();}},chime:function(e){e.preventDefault();origEventType=e.type;origEventTarget=$(e.target);chimeType=e.target.className.indexOf("twist")===-1?"chime":"twist";if(!isAuthenticated){flowType="chime";steps.chime();}else{triggerChimeEvent({type:"member"});}},newsletters:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="newsletters";steps.newslettersByVertical();},newsletters_nudge:function(){newsletterOverride=true;this.newsletters(jQuery.Event("click"));},avatar:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="avatar";steps.avatarOrUpload(origEventTarget);},photo:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="photo";steps.uploadPhoto(origEventTarget);},insertPhoto:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="insert-photo";steps.insertOrUploadPhoto(origEventTarget);},save:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();if(!isAuthenticated){e.preventDefault();flowType="login";steps.login();}else{flowType="save";saveURL=origEventTarget.attr("href");steps.addSave(origEventTarget);}},deleteSave:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="delete-save";saveURL=origEventTarget.attr("href");saveId=origEventTarget.attr("rel");steps.deleteSave(origEventTarget);},editSave:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="edit-save";steps.editSave(origEventTarget);saveId=origEventTarget.attr("rel");},insertSave:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="insert-save";steps.insertSave(origEventTarget);},completeRegistration:function(){},isSsoReady:function(){return ssoReady;},isLoggedIn:function(){return isAuthenticated;},getUserId:function(){return isAuthenticated?userId:0;},getAvatarId:function(){return isAuthenticated?avatarId:0;},getUsername:function(){return isAuthenticated?username:"";},loadAddConnectionUI:function(){if(typeof(gigya)!="undefined"&&!options.addConnectionsUILoaded&&options.addConnectionsUILoadindAttempts<10){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if($("#"+options.addConnectionsUIParams.containerID).length>0){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onConnectionEditParams);gigya.services.socialize.showAddConnectionsUI(options.gigyaConfig,options.addConnectionsUIParams);options.addConnectionsUILoaded=true;$(".add_connection_edit_btn").css("display","none").removeClass("hide").show().live("click",function(){gigya.services.socialize.showEditConnectionsUI(options.gigyaConfig,{});});}else{if($("#"+options.addConnectionsUISmallParams.containerID).length>0){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onConnectionEditParams);gigya.services.socialize.showAddConnectionsUI(options.gigyaConfig,options.addConnectionsUISmallParams);options.addConnectionsUILoaded=true;$(".add_connection_edit_btn").css("display","none").removeClass("hide").show().live("click",function(){gigya.services.socialize.showEditConnectionsUI(options.gigyaConfig,{});});}else{options.addConnectionsUILoaded=true;}}}else{options.addConnectionsUILoadindAttempts++;setTimeout(iV_SSO.loadAddConnectionUI,20);}},loadLoginUIOnPage:function(){if(typeof(gigya)!="undefined"&&!options.loginUILoaded&&options.loginUILoadindAttempts<10){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}if($("#"+options.globalLayoutLoginUIParams.containerID).length>0){gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.globalLayoutLoginUIParams));options.loginUILoaded=true;$(".gigya-login-pretext").show();}else{if($("#"+options.channelLayoutLoginUIParams.containerID).length>0){gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.channelLayoutLoginUIParams));options.loginUILoaded=true;$(".gigya-login-pretext").show();}else{options.loginUILoaded=true;}}}else{options.loginUILoadindAttempts++;setTimeout(iV_SSO.loadLoginUIOnPage,20);}},uploadUGC:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="login";steps.login();}else{e.preventDefault();flowType="ugc-upload";steps.ugc_upload();}},compareUsername:function(){if(!$.cookie("iv_id")){console.warn("cookie found so logged in");console.log("case 1");$(".if-logged-out").show();$(".if-logged-in").remove();}else{console.log("case 2");$(".if-logged-in").show();$(".if-logged-out").remove();$(".username").each(function(){var HTML=$(this).text(),cookie=$.cookie("iv_id");if(HTML.toLowerCase()!=cookie){$(this).text(cookie.capitalize());}$(this).show();});}},init:function(custom){var path,xd_receiver_path;if(inited){return;}var ssoBox=$("#sso-cbox-loaded-content");iVillage=window.iVillage||{};if(!ssoBox.length){setTimeout(init,20);}else{$.extend(options,custom);if(options.baseUrl.length-options.baseUrl.lastIndexOf("/")>1){options.baseUrl+="/";}log("init()",options);proxyOrBase=options.proxyUrl||options.baseUrl;uploadSwf=options.baseUrl+"public/flash/uploadify.swf";htmlBase=proxyOrBase+"photo-contests/endless-summer/ajax/sso-html/";$.getScript(options.gigyaAPIURL+"?apikey="+iVillage.gigya_api_key,function(){log("init() > Loaded Gigya API");$(document).trigger("gigya.ready");});getPaths={login:htmlBase+"login",forgotPassword:htmlBase+"forgot-password",register:htmlBase+"register",gigyaRegister:htmlBase+"gigya-register",askForPassword:htmlBase+"ask-for-password",askForEmail:htmlBase+"ask-for-email",linkExistingFBUser:htmlBase+"link-existing-fb-user",chime:htmlBase+"chime-in",avatarOrUpload:htmlBase+"avatar-or-upload",allAvatars:htmlBase+"all-avatars",uploadAvatar:htmlBase+"upload-avatar",uploadPhoto:htmlBase+"upload-photo",thanks:htmlBase+"thanks",newsletterList:htmlBase+"newsletter-list",insertOrUploadPhoto:htmlBase+"insert-or-upload-photo",pickPhoto:htmlBase+"pick-photo",uploadUGC:htmlBase+"upload-ugc",socialGetEmail:htmlBase+"social-get-email",addSave:htmlBase+"add-save",deleteSave:htmlBase+"delete-save",insertSave:htmlBase+"insert-save",editSave:htmlBase+"edit-save"};postPaths={login:proxyOrBase+"photo-contests/endless-summer/ajax/user/sign-in",gigyaLogin:proxyOrBase+"photo-contests/endless-summer/ajax/gigya/login",gigyaRegister:proxyOrBase+"photo-contests/endless-summer/ajax/gigya/register",editedConnection:proxyOrBase+"ajax/gigya/extend-profile",userUpdateFBProfile:proxyOrBase+"ajax/gigya/update-profile",logout:proxyOrBase+"photo-contests/endless-summer/ajax/user/sign-out",register:proxyOrBase+"photo-contests/endless-summer/ajax/user/sign-up",forgotPassword:proxyOrBase+"ajax/user/forgot-password",getToken:proxyOrBase+"ajax/user/get-token",establishSession:proxyOrBase+"ajax/user/establish-session",createPhoto:proxyOrBase+"photo/create",createUGCPhoto:proxyOrBase+"photo/create-ugc-photo",deletePhoto:proxyOrBase+"ajax/photo/delete",flipPhoto:proxyOrBase+"ajax/photo/flip",rotatePhoto:proxyOrBase+"ajax/photo/rotate",setAvatar:proxyOrBase+"ajax/photo/set-avatar",cropAvatar:proxyOrBase+"ajax/photo/crop",setChildren:proxyOrBase+"ajax/user/set-children",newslettersByVert:proxyOrBase+"ajax/newsletter/get-by-vertical",newsletterSignUp:proxyOrBase+"photo-contests/endless-summer/ajax/user/set-newsletters",socialEmail:proxyOrBase+"ajax/social/email",addSave:proxyOrBase+"ajax/saves/add",deleteSave:proxyOrBase+"ajax/saves/delete",embedSave:proxyOrBase+"ajax/saves/embed",editSave:proxyOrBase+"ajax/saves/edit",createUGCSlide:proxyOrBase+"ajax/ugc/create_slide"};ssoBox.parents("#sso-cbox").after('<div id="sso-avatar-overlay"><a class="sso-avatar" href="#"></a></div>');avatarOverlay=$("#sso-avatar-overlay");getToken();ssoBox.find("a.sso-step").live("click",handleStep);ssoBox.find("a.sso-new-window").live("click",handleNewWindow);ssoBox.find("a.sso-form-submit").live("click",handleFormSubmitter);ssoBox.find("a.sso-paginate").live("click",handlePaginate);ssoBox.find("a.sso-rotate-left").live("click",rotateCounterClockwise);ssoBox.find("a.sso-rotate-right").live("click",rotateClockwise);ssoBox.find("#sso-pick-photo a").live("click",handlePickPhoto);ssoBox.find("a.sso-finish").live("click",handleFinish);ssoBox.find("a.sso-close").live("click",handleClose);ssoBox.find("#sso-children a.btn-add-another").live("click",cloneBirthdayRow);ssoBox.find("#sso-upload-photo a#sso-upload-another").live("click",handleAddAnotherPhoto);ssoBox.find("form").live("submit",formProcessor);ssoBox.find("li.avatar").live("mouseover mouseout",avatarTelescope);avatarOverlay.hover(function(){avatarOverlay.data("over",true);},function(){if(avatarOverlay.data("over")){avatarOverlayCleanup();}}).mousemove(avatarOverlayCheckPosition);ssoBox.find("a.sso-avatar").live("click",handleChooseAvatar);avatarOverlay.children("a").click(handleChooseAvatar);$(document).bind("sso_cbox_closed",fireOriginalEventOrReload);if($.browser.msie&&parseInt($.browser.version,10)<8){ssoBox.find("input:text, input:password").live("keypress",function(e){var code=e.keyCode?e.keyCode:e.which;if(code===13){form.submit();}});}log("init() > Complete.");iV_SSO.loadLoginUIOnPage();iV_SSO.loadAddConnectionUI();iV_SSO.compareUsername();}}};})(this,jQuery);